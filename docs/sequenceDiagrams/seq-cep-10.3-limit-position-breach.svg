<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1489.6px" preserveAspectRatio="none" style="width:735px;height:1489px;" version="1.1" viewBox="0 0 735 1489" width="735.2px" zoomAndPan="magnify"><defs><filter height="300%" id="f23cpxi07cvnv" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.600000023841858"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="3.200000047683716" dy="3.200000047683716" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="11.2" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="247.2" x="245" y="18.8281">10.3. Limit Position Breach Rule Validation</text><rect fill="#FFFFE0" height="1453.5735" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="220.8" x="23.2" y="27.5906"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="86.4" x="90.4" y="37.6453">Central Services</text><rect fill="#90EE90" height="1453.5735" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="391.2" x="314.8" y="27.5906"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="181.6" x="419.6" y="37.6453">Central Event Processing Services</text><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="66.8" y="376.65"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="66.8" y="510.4438"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="178" y="195.4625"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="1310.1625" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="381.2" y="103.0203"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="670" y="424.0984"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="106.0422" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="670" y="557.8922"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="670" y="777.1766"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="93.7938" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="670" y="1076.6735"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="670" y="1332.9703"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="1304.5625" style="stroke: #000000; stroke-width: 1.600000023841858;" width="716.4" x="10.4" y="108.6203"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="1074.0781" style="stroke: #000000; stroke-width: 1.600000023841858;" width="700.4" x="18.4" y="333.5047"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="472.6484" style="stroke: #000000; stroke-width: 1.600000023841858;" width="408.8" x="302" y="917.3703"/><rect fill="#FFFFFF" height="376.2063" style="stroke: none; stroke-width: 0.800000011920929;" width="408.8" x="302" y="1013.8125"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="59.6609" style="stroke: #000000; stroke-width: 1.600000023841858;" width="305.6" x="310" y="1250.661"/><rect fill="#FFFFFF" height="11.9641" style="stroke: none; stroke-width: 0.800000011920929;" width="305.6" x="310" y="1298.3578"/><rect fill="#FFFFFF" height="11.9641" style="stroke: none; stroke-width: 0.800000011920929;" width="700.4" x="18.4" y="1395.6188"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="70.4" x2="70.4" y1="95.0203" y2="1426.7828"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="181.6" x2="181.6" y1="95.0203" y2="1426.7828"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="385.2" x2="385.2" y1="95.0203" y2="1426.7828"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="674" x2="674" y1="95.0203" y2="1426.7828"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="84" x="26.4" y="79.4672">Central-Ledger</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="56.8" x="40" y="92.6578">Admin API</text><path d="M54.4,46.2391 L54.4,65.4391 M54.4,55.8391 L68,55.8391 " fill="none" filter="url(#f23cpxi07cvnv)" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><ellipse cx="77.6" cy="55.8391" fill="#FEFECE" filter="url(#f23cpxi07cvnv)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="84" x="26.4" y="1436.811">Central-Ledger</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="56.8" x="40" y="1450.0016">Admin API</text><path d="M54.4,1455.5641 L54.4,1474.7641 M54.4,1465.1641 L68,1465.1641 " fill="none" filter="url(#f23cpxi07cvnv)" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><ellipse cx="77.6" cy="1465.1641" fill="#FEFECE" filter="url(#f23cpxi07cvnv)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><rect fill="#FEFECE" filter="url(#f23cpxi07cvnv)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="126.4" y="63.4297"/><rect fill="#FEFECE" filter="url(#f23cpxi07cvnv)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="123.2" y="66.6297"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="100" x="128.8" y="83.0578">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f23cpxi07cvnv)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="126.4" y="1425.9828"/><rect fill="#FEFECE" filter="url(#f23cpxi07cvnv)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="123.2" y="1429.1828"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="100" x="128.8" y="1445.611">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="129.6" x="318" y="92.6578">Central Event Processor</text><ellipse cx="385.2" cy="69.0297" fill="#FEFECE" filter="url(#f23cpxi07cvnv)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><polygon fill="#A80036" points="382,59.4297,386.8,55.4297,385.2,59.4297,386.8,63.4297,382,59.4297" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="129.6" x="318" y="1436.811">Central Event Processor</text><ellipse cx="385.2" cy="1451.9735" fill="#FEFECE" filter="url(#f23cpxi07cvnv)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><polygon fill="#A80036" points="382,1442.3735,386.8,1438.3735,385.2,1442.3735,386.8,1446.3735,382,1442.3735" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="52.8" x="645.2" y="92.6578">CEP Store</text><path d="M659.6,53.0297 C659.6,45.0297 674,45.0297 674,45.0297 C674,45.0297 688.4,45.0297 688.4,53.0297 L688.4,73.8297 C688.4,81.8297 674,81.8297 674,81.8297 C674,81.8297 659.6,81.8297 659.6,73.8297 L659.6,53.0297 " fill="#FEFECE" filter="url(#f23cpxi07cvnv)" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><path d="M659.6,53.0297 C659.6,61.0297 674,61.0297 674,61.0297 C674,61.0297 688.4,61.0297 688.4,53.0297 " fill="none" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="52.8" x="645.2" y="1436.811">CEP Store</text><path d="M659.6,1447.1735 C659.6,1439.1735 674,1439.1735 674,1439.1735 C674,1439.1735 688.4,1439.1735 688.4,1447.1735 L688.4,1467.9735 C688.4,1475.9735 674,1475.9735 674,1475.9735 C674,1475.9735 659.6,1475.9735 659.6,1467.9735 L659.6,1447.1735 " fill="#FEFECE" filter="url(#f23cpxi07cvnv)" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><path d="M659.6,1447.1735 C659.6,1455.1735 674,1455.1735 674,1455.1735 C674,1455.1735 688.4,1455.1735 688.4,1447.1735 " fill="none" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="66.8" y="376.65"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="66.8" y="510.4438"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="178" y="195.4625"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="1310.1625" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="381.2" y="103.0203"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="670" y="424.0984"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="106.0422" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="670" y="557.8922"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="670" y="777.1766"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="93.7938" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="670" y="1076.6735"/><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="670" y="1332.9703"/><path d="M10.4,108.6203 L159.2,108.6203 L159.2,114.2203 L151.2,122.2203 L10.4,122.2203 L10.4,108.6203 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="1304.5625" style="stroke: #000000; stroke-width: 1.600000023841858;" width="716.4" x="10.4" y="108.6203"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112.8" x="22.4" y="119.475">Limit Position Breach</text><path d="M52.8,126.4688 L52.8,170.4688 L174.4,170.4688 L174.4,134.4688 L166.4,126.4688 L52.8,126.4688 " fill="#D3D3D3" filter="url(#f23cpxi07cvnv)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M166.4,126.4688 L166.4,134.4688 L174.4,134.4688 L166.4,126.4688 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="104" x="57.6" y="140.5234">Events are published</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="104.8" x="57.6" y="152.7719">to Notification Topic</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="98.4" x="57.6" y="165.0203">by Central Services.</text><polygon fill="#A80036" points="194.8,192.2625,186.8,195.4625,194.8,198.6625,191.6,195.4625" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="190" x2="380.4" y1="195.4625" y2="195.4625"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="199.6" y="191.6688">1</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="167.2" x="210" y="191.6688">Consumes notification messages</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="389.2" x2="422.8" y1="242.9109" y2="242.9109"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="422.8" x2="422.8" y1="242.9109" y2="253.3109"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="390" x2="422.8" y1="253.3109" y2="253.3109"/><polygon fill="#A80036" points="398,250.1109,390,253.3109,398,256.5109,394.8,253.3109" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="394.8" y="239.1172">2</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="156.8" x="405.2" y="239.1172">Filter according to event action</text><path d="M392.8,263.7109 L392.8,320.5109 L661.6,320.5109 L661.6,271.7109 L653.6,263.7109 L392.8,263.7109 " fill="#FFFF00" filter="url(#f23cpxi07cvnv)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M653.6,263.7109 L653.6,271.7109 L661.6,271.7109 L653.6,263.7109 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="120" x="397.6" y="277.7656">Qualifying event action:</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="397.6" y="290.0141">{</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="239.2" x="410.4" y="302.2625">data.value.metadata.event.action === 'commit'</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="397.6" y="314.5109">}</text><path d="M18.4,333.5047 L68,333.5047 L68,339.1047 L60,347.1047 L18.4,347.1047 L18.4,333.5047 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="1074.0781" style="stroke: #000000; stroke-width: 1.600000023841858;" width="700.4" x="18.4" y="333.5047"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13.6" x="30.4" y="344.3594">alt</text><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="152" x="80" y="343.6125">[Messages event type that qualify]</text><polygon fill="#A80036" points="83.6,373.45,75.6,376.65,83.6,379.85,80.4,376.65" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="78.8" x2="380.4" y1="376.65" y2="376.65"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="88.4" y="366.732">3</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="252.8" x="98.8" y="360.6078">Request notification info for both payee and payer</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64" x="98.8" y="372.8563">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="57.6" x="166" y="372.8563">2001, 2003</text><polygon fill="#A80036" points="660.4,420.8984,668.4,424.0984,660.4,427.2984,663.6,424.0984" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="389.2" x2="665.2" y1="424.0984" y2="424.0984"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="394.8" y="420.3047">4</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="207.2" x="405.2" y="420.3047">Persist message related data to CEP store</text><polygon fill="#FFFFE0" filter="url(#f23cpxi07cvnv)" points="656,458.4984,692,458.4984,700,467.2984,692,476.8984,656,476.8984,648,467.2984,656,458.4984" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="32.8" x="657.6" y="471.7531">events</text><polygon fill="#A80036" points="83.6,507.2438,75.6,510.4438,83.6,513.6438,80.4,510.4438" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="78.8" x2="380.4" y1="510.4438" y2="510.4438"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="88.4" y="500.5258">5</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="280.8" x="98.8" y="494.4016">Request current positions info for both payee and payer</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64" x="98.8" y="506.65">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="57.6" x="166" y="506.65">2001, 2003</text><polygon fill="#A80036" points="660.4,554.6922,668.4,557.8922,660.4,561.0922,663.6,557.8922" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="389.2" x2="665.2" y1="557.8922" y2="557.8922"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="394.8" y="554.0984">6</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="111.2" x="405.2" y="554.0984">Request current limits</text><polygon fill="#FFFFE0" filter="url(#f23cpxi07cvnv)" points="657.6,568.2922,689.6,568.2922,697.6,577.0922,689.6,586.6922,657.6,586.6922,649.6,577.0922,657.6,568.2922" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="28.8" x="659.2" y="581.5469">limits</text><path d="M392.8,594.9406 L392.8,638.9406 L535.2,638.9406 L535.2,602.9406 L527.2,594.9406 L392.8,594.9406 " fill="#D3D3D3" filter="url(#f23cpxi07cvnv)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M527.2,594.9406 L527.2,602.9406 L535.2,602.9406 L527.2,594.9406 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="100.8" x="397.6" y="608.9953">API call to CEP Store</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="92.8" x="397.6" y="621.2438">requesting current</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29.6" x="493.6" y="621.2438">limits</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="397.6" y="633.4922">for</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32.8" x="415.2" y="633.4922">payee</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="18.4" x="451.2" y="633.4922">and</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31.2" x="472.8" y="633.4922">payer</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="504" y="633.4922">.</text><polygon fill="#A80036" points="398,660.7344,390,663.9344,398,667.1344,394.8,663.9344" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="393.2" x2="673.2" y1="663.9344" y2="663.9344"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="402.8" y="660.1406">7</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="141.6" x="413.2" y="660.1406">Return results current limits</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="389.2" x2="422.8" y1="687.3828" y2="687.3828"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="422.8" x2="422.8" y1="687.3828" y2="697.7828"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="390" x2="422.8" y1="697.7828" y2="697.7828"/><polygon fill="#A80036" points="398,694.5828,390,697.7828,398,700.9828,394.8,697.7828" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="394.8" y="683.5891">8</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="408.4" y="683.5891"/><path d="M392.8,708.1828 L392.8,752.1828 L607.2,752.1828 L607.2,716.1828 L599.2,708.1828 L392.8,708.1828 " fill="#D3D3D3" filter="url(#f23cpxi07cvnv)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M599.2,708.1828 L599.2,716.1828 L607.2,716.1828 L599.2,708.1828 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="104.8" x="397.6" y="722.2375">Calculate the current</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="52" x="505.6" y="722.2375">threshold</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="61.6" x="397.6" y="734.4859">percentage</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="40.8" x="462.4" y="734.4859">for both</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32.8" x="506.4" y="734.4859">payee</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="18.4" x="542.4" y="734.4859">and</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31.2" x="564" y="734.4859">payer</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="29.6" x="397.6" y="746.7344">for all</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.8" x="430.4" y="746.7344">currencies</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="487.2" y="746.7344">.</text><polygon fill="#A80036" points="660.4,773.9766,668.4,777.1766,660.4,780.3766,663.6,777.1766" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="389.2" x2="665.2" y1="777.1766" y2="777.1766"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="394.8" y="773.3828">9</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="240" x="405.2" y="773.3828">Persist new position with threshold information</text><polygon fill="#FFFFE0" filter="url(#f23cpxi07cvnv)" points="657.6,811.5766,689.6,811.5766,697.6,820.3766,689.6,829.9766,657.6,829.9766,649.6,820.3766,657.6,811.5766" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="28.8" x="659.2" y="824.8313">limits</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="389.2" x2="422.8" y1="851.2735" y2="851.2735"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="422.8" x2="422.8" y1="851.2735" y2="861.6735"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="390" x2="422.8" y1="861.6735" y2="861.6735"/><polygon fill="#A80036" points="398,858.4735,390,861.6735,398,864.8735,394.8,861.6735" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="394.8" y="847.4797">10</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="415.6" y="847.4797"/><path d="M392.8,872.0735 L392.8,904.0735 L508,904.0735 L508,880.0735 L500,872.0735 L392.8,872.0735 " fill="#D3D3D3" filter="url(#f23cpxi07cvnv)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M500,872.0735 L500,880.0735 L508,880.0735 L500,872.0735 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="74.4" x="397.6" y="886.1281">Evaluate 'facts'</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="98.4" x="397.6" y="898.3766">Invoke Rule Engine.</text><path d="M302,917.3703 L351.6,917.3703 L351.6,922.9703 L343.6,930.9703 L302,930.9703 L302,917.3703 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="472.6484" style="stroke: #000000; stroke-width: 1.600000023841858;" width="408.8" x="302" y="917.3703"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13.6" x="314" y="928.225">alt</text><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="106.4" x="363.6" y="927.4781">[Threshold is breached]</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="389.2" x2="422.8" y1="948.2672" y2="948.2672"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="422.8" x2="422.8" y1="948.2672" y2="958.6672"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="390" x2="422.8" y1="958.6672" y2="958.6672"/><polygon fill="#A80036" points="398,955.4672,390,958.6672,398,961.8672,394.8,958.6672" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="394.8" y="944.4735">11</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="55.2" x="412.4" y="944.4735">Create new</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72.8" x="470.8" y="944.4735">Action Object</text><rect fill="#FFFFFF" filter="url(#f23cpxi07cvnv)" height="44.7453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="164" x="315.6" y="965.0672"/><polygon fill="#EEEEEE" points="315.6,965.0672,366.8,965.0672,366.8,970.6672,358.8,978.6672,315.6,978.6672,315.6,965.0672" style="stroke: #000000; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15.2" x="326" y="976.7219">ref</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="128.8" x="320.4" y="991.9219">Notification Action Flow {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/central-event-processor/tree/master/docs/sequenceDiagrams/seq-cep-10.4-action-flow.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/central-event-processor/tree/master/docs/sequenceDiagrams/seq-cep-10.4-action-flow.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="22.4" x="449.2" y="991.9219">10.4</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="449.2" x2="471.6" y1="993.5219" y2="993.5219"/></a><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="471.6" y="991.9219">}</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="323.6" y="1004.1703"/><line style="stroke: #000000; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="302" x2="710.8" y1="1014.6125" y2="1014.6125"/><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="175.2" x="306" y="1023.1203">[Threshold not breached - same event]</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="389.2" x2="422.8" y1="1042.825" y2="1042.825"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="422.8" x2="422.8" y1="1042.825" y2="1053.225"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="390" x2="422.8" y1="1053.225" y2="1053.225"/><polygon fill="#A80036" points="398,1050.025,390,1053.225,398,1056.425,394.8,1053.225" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="394.8" y="1039.0313">12</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="56" x="412.4" y="1039.0313">Send finish</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72.8" x="471.6" y="1039.0313">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="79.2" x="547.6" y="1039.0313">to Action Agent</text><polygon fill="#A80036" points="660.4,1073.4735,668.4,1076.6735,660.4,1079.8735,663.6,1076.6735" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="389.2" x2="665.2" y1="1076.6735" y2="1076.6735"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="394.8" y="1072.8797">13</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="40" x="412.4" y="1072.8797">Request</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72.8" x="455.6" y="1072.8797">Action Object</text><path d="M392.8,1087.0735 L392.8,1119.0735 L572,1119.0735 L572,1095.0735 L564,1087.0735 L392.8,1087.0735 " fill="#D3D3D3" filter="url(#f23cpxi07cvnv)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M564,1087.0735 L564,1095.0735 L572,1095.0735 L564,1087.0735 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="86.4" x="397.6" y="1101.1281">Request previous</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72.8" x="487.2" y="1101.1281">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="121.6" x="397.6" y="1113.3766">with same event details.</text><polygon fill="#FFFFE0" filter="url(#f23cpxi07cvnv)" points="656.8,1130.7703,691.2,1130.7703,699.2,1139.5703,691.2,1149.1703,656.8,1149.1703,648.8,1139.5703,656.8,1130.7703" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="31.2" x="658.4" y="1144.025">action</text><polygon fill="#A80036" points="398,1167.2672,390,1170.4672,398,1173.6672,394.8,1170.4672" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="393.2" x2="673.2" y1="1170.4672" y2="1170.4672"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="402.8" y="1166.6735">14</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="70.4" x="420.4" y="1166.6735">Return results</text><path d="M392.8,1180.8672 L392.8,1237.6672 L686.4,1237.6672 L686.4,1188.8672 L678.4,1180.8672 L392.8,1180.8672 " fill="#FFFF00" filter="url(#f23cpxi07cvnv)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M678.4,1180.8672 L678.4,1188.8672 L686.4,1188.8672 L678.4,1180.8672 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="81.6" x="397.6" y="1194.9219">Event details for</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72.8" x="482.4" y="1194.9219">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="555.2" y="1194.9219">:</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="397.6" y="1207.1703">{</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="264" x="410.4" y="1219.4188">limit type, currency, dfsp, notification endpoint type</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="397.6" y="1231.6672">}</text><path d="M310,1250.661 L359.6,1250.661 L359.6,1256.261 L351.6,1264.261 L310,1264.261 L310,1250.661 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="59.6609" style="stroke: #000000; stroke-width: 1.600000023841858;" width="305.6" x="310" y="1250.661"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13.6" x="322" y="1261.5156">alt</text><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87.2" x="371.6" y="1260.7688">[Action Event exist]</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="389.2" x2="422.8" y1="1281.5578" y2="1281.5578"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="422.8" x2="422.8" y1="1281.5578" y2="1291.9578"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="390" x2="422.8" y1="1291.9578" y2="1291.9578"/><polygon fill="#A80036" points="398,1288.7578,390,1291.9578,398,1295.1578,394.8,1291.9578" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="394.8" y="1277.7641">15</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="87.2" x="412.4" y="1277.7641">Deactive pending</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72.8" x="502.8" y="1277.7641">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="27.2" x="578.8" y="1277.7641">event</text><line style="stroke: #000000; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="310" x2="615.6" y1="1299.1578" y2="1299.1578"/><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128.8" x="314" y="1307.6656">[Action Event does not exist]</text><polygon fill="#A80036" points="660.4,1329.7703,668.4,1332.9703,660.4,1336.1703,663.6,1332.9703" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="389.2" x2="665.2" y1="1332.9703" y2="1332.9703"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="394.8" y="1329.1766">16</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="77.6" x="412.4" y="1329.1766">Persist updated</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72.8" x="493.2" y="1329.1766">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="91.2" x="569.2" y="1329.1766">event to CEP Store</text><polygon fill="#FFFFE0" filter="url(#f23cpxi07cvnv)" points="656.8,1367.3703,691.2,1367.3703,699.2,1376.1703,691.2,1385.7703,656.8,1385.7703,648.8,1376.1703,656.8,1367.3703" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="31.2" x="658.4" y="1380.625">action</text><line style="stroke: #000000; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="18.4" x2="718.8" y1="1396.4188" y2="1396.4188"/><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="222.4" x="22.4" y="1404.9266">[Message does not qualify for notification action]</text><!--
@startuml
title 10.3. Limit Position Breach Rule Validation
autonumber

collections "Notification-Topic" as topicNotify
boundary "Central-Ledger\nAdmin API" as CLAPI
control "Central Event Processor" as CEP
database "CEP Store" as DB

box "Central Services" #LightYellow
participant CLAPI
participant topicNotify
end box
box "Central Event Processing Services" #LightGreen
participant CEP
participant DB
end box

Group Limit Position Breach
    activate CEP
    note left of topicNotify #LightGrey
        Events are published
        to Notification Topic
        by Central Services.
    end note
    topicNotify <- CEP: Consumes notification messages
    activate topicNotify
    deactivate topicNotify
    CEP -> CEP: Filter according to event action
    note right of CEP #yellow
        Qualifying event action:
        {
            data.value.metadata.event.action === 'commit'
        }
    end note

    alt Messages event type that qualify
        CLAPI <- CEP: Request notification info for both payee and payer\n<color #FF0000><b>Error codes:</b> 2001, 2003 </color>
        activate CLAPI
        deactivate CLAPI
        CEP -> DB: Persist message related data to CEP store
        activate DB
        hnote over DB #LightYellow
            events
        end hnote
        deactivate DB
        CLAPI <- CEP: Request current positions info for both payee and payer\n<color #FF0000><b>Error codes:</b> 2001, 2003 </color>
        activate CLAPI
        deactivate CLAPI
        CEP -> DB: Request current limits
        activate DB
        hnote over DB #LightYellow
            limits
        end hnote
        note right of CEP #LightGrey
            API call to CEP Store
            requesting current **limits**
            for **payee** and **payer**.
        end note
        CEP <- - DB: Return results current limits
        deactivate DB
        CEP -> CEP:
        note right of CEP #LightGrey
            Calculate the current **threshold**
            **percentage** for both **payee** and **payer**
            for all **currencies**.
        end note
        CEP -> DB: Persist new position with threshold information
        activate DB
        hnote over DB #LightYellow
            limits
        end hnote
        deactivate DB
        CEP -> CEP
        note right of CEP #LightGrey
            Evaluate 'facts'
            Invoke Rule Engine.
        end note

        alt Threshold is breached
            CEP -> CEP: Create new **Action Object**
            ref over CEP :  Notification Action Flow {[[https://github.com/mojaloop/central-event-processor/tree/master/docs/sequenceDiagrams/seq-cep-10.4-action-flow.svg 10.4]]} \n
        else Threshold not breached - same event
            CEP -> CEP: Send finish **Action Object** to Action Agent
            CEP -> DB: Request **Action Object**
            note right of CEP #LightGrey
                Request previous **Action Object**
                with same event details.
            end note
            activate DB
        hnote over DB #LightYellow
            action
        end hnote
        CEP <- - DB: Return results
        deactivate DB
            note right of CEP #yellow
                Event details for **Action Object**:
                {
                    limit type, currency, dfsp, notification endpoint type
                }
            end note
            alt Action Event exist
                CEP -> CEP: Deactive pending **Action Object** event
            else Action Event does not exist
            end
        CEP -> DB: Persist updated **Action Object** event to CEP Store
        activate DB
        hnote over DB #LightYellow
            action
        end hnote
        deactivate DB
        end
    else Message does not qualify for notification action
    end
    deactivate CEP
end
@enduml

PlantUML version 1.2018.11(Sat Sep 22 18:43:53 SAST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1343-b26
Operating System: Mac OS X
OS Version: 10.14.2
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>