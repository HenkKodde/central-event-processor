<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2056px" preserveAspectRatio="none" style="width:919px;height:2056px;" version="1.1" viewBox="0 0 919 2056" width="919px" zoomAndPan="magnify"><defs><filter height="300%" id="fgiwom38axpf1" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="400" x="260.75" y="23.5352">10.3. Notification Limit Position Breach Rule Validation</text><rect fill="#FFFFE0" height="2011.4512" style="stroke: #A80036; stroke-width: 1.0;" width="276" x="29" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="113" y="47.0566">Central Services</text><rect fill="#90EE90" height="2011.4512" style="stroke: #A80036; stroke-width: 1.0;" width="489" x="393.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="227" x="524.5" y="47.0566">Central Event Processing Services</text><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="83.5" y="486.123"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="83.5" y="653.3652"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="222.5" y="244.3281"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="1832.1875" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="476.5" y="128.7754"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="837.5" y="545.4336"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="132.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="837.5" y="712.6758"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="837.5" y="986.7813"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="117.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="837.5" y="1439.7734"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="837.5" y="1860.6973"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="1825.1875" style="stroke: #000000; stroke-width: 2.0;" width="895.5" x="13" y="135.7754"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="1521.7715" style="stroke: #000000; stroke-width: 2.0;" width="875.5" x="23" y="432.1914"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="769.9844" style="stroke: #000000; stroke-width: 2.0;" width="511" x="377.5" y="1162.0234"/><rect fill="#FFFFFF" height="610.1211" style="stroke: none; stroke-width: 1.0;" width="511" x="377.5" y="1321.8867"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="113.8867" style="stroke: #000000; stroke-width: 2.0;" width="380.5" x="387.5" y="1718.5"/><rect fill="#FFFFFF" height="14.9551" style="stroke: none; stroke-width: 1.0;" width="380.5" x="387.5" y="1817.4316"/><rect fill="#FFFFFF" height="14.9551" style="stroke: none; stroke-width: 1.0;" width="875.5" x="23" y="1939.0078"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="88" x2="88" y1="118.7754" y2="1977.9629"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="227" x2="227" y1="118.7754" y2="1977.9629"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="481.5" x2="481.5" y1="118.7754" y2="1977.9629"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="842.5" x2="842.5" y1="118.7754" y2="1977.9629"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="33" y="99.334">Central-Ledger</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="50" y="115.8223">Admin API</text><path d="M68,57.7988 L68,81.7988 M68,69.7988 L85,69.7988 " fill="none" filter="url(#fgiwom38axpf1)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="97" cy="69.7988" fill="#FEFECE" filter="url(#fgiwom38axpf1)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="33" y="1990.498">Central-Ledger</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="50" y="2006.9863">Admin API</text><path d="M68,2013.9395 L68,2037.9395 M68,2025.9395 L85,2025.9395 " fill="none" filter="url(#fgiwom38axpf1)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="97" cy="2025.9395" fill="#FEFECE" filter="url(#fgiwom38axpf1)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fgiwom38axpf1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="158" y="79.2871"/><rect fill="#FEFECE" filter="url(#fgiwom38axpf1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="154" y="83.2871"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="161" y="103.8223">Notification-Topic</text><rect fill="#FEFECE" filter="url(#fgiwom38axpf1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="158" y="1976.9629"/><rect fill="#FEFECE" filter="url(#fgiwom38axpf1)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="154" y="1980.9629"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="161" y="2001.498">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="162" x="397.5" y="115.8223">Central Event Processor</text><ellipse cx="481.5" cy="86.2871" fill="#FEFECE" filter="url(#fgiwom38axpf1)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="477.5,74.2871,483.5,69.2871,481.5,74.2871,483.5,79.2871,477.5,74.2871" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="162" x="397.5" y="1990.498">Central Event Processor</text><ellipse cx="481.5" cy="2009.4512" fill="#FEFECE" filter="url(#fgiwom38axpf1)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="477.5,1997.4512,483.5,1992.4512,481.5,1997.4512,483.5,2002.4512,477.5,1997.4512" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="806.5" y="115.8223">CEP Store</text><path d="M824.5,66.2871 C824.5,56.2871 842.5,56.2871 842.5,56.2871 C842.5,56.2871 860.5,56.2871 860.5,66.2871 L860.5,92.2871 C860.5,102.2871 842.5,102.2871 842.5,102.2871 C842.5,102.2871 824.5,102.2871 824.5,92.2871 L824.5,66.2871 " fill="#FEFECE" filter="url(#fgiwom38axpf1)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M824.5,66.2871 C824.5,76.2871 842.5,76.2871 842.5,76.2871 C842.5,76.2871 860.5,76.2871 860.5,66.2871 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="806.5" y="1990.498">CEP Store</text><path d="M824.5,2003.4512 C824.5,1993.4512 842.5,1993.4512 842.5,1993.4512 C842.5,1993.4512 860.5,1993.4512 860.5,2003.4512 L860.5,2029.4512 C860.5,2039.4512 842.5,2039.4512 842.5,2039.4512 C842.5,2039.4512 824.5,2039.4512 824.5,2029.4512 L824.5,2003.4512 " fill="#FEFECE" filter="url(#fgiwom38axpf1)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M824.5,2003.4512 C824.5,2013.4512 842.5,2013.4512 842.5,2013.4512 C842.5,2013.4512 860.5,2013.4512 860.5,2003.4512 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="83.5" y="486.123"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="83.5" y="653.3652"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="222.5" y="244.3281"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="1832.1875" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="476.5" y="128.7754"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="837.5" y="545.4336"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="132.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="837.5" y="712.6758"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="837.5" y="986.7813"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="117.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="837.5" y="1439.7734"/><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="837.5" y="1860.6973"/><path d="M13,135.7754 L199,135.7754 L199,142.7754 L189,152.7754 L13,152.7754 L13,135.7754 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1825.1875" style="stroke: #000000; stroke-width: 2.0;" width="895.5" x="13" y="135.7754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="141" x="28" y="149.3438">Limit Position Breach</text><path d="M232,158.0859 L232,213.0859 L384,213.0859 L384,168.0859 L374,158.0859 L232,158.0859 " fill="#D3D3D3" filter="url(#fgiwom38axpf1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M374,158.0859 L374,168.0859 L384,168.0859 L374,158.0859 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="238" y="175.6543">Events are published</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="238" y="190.9648">to Notification Topic</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="238" y="206.2754">by Central Services</text><polygon fill="#A80036" points="243.5,240.3281,233.5,244.3281,243.5,248.3281,239.5,244.3281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="237.5" x2="475.5" y1="244.3281" y2="244.3281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="249.5" y="239.5859">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="262.5" y="239.5859">Consumes notification messages</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="486.5" x2="528.5" y1="303.6387" y2="303.6387"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="528.5" x2="528.5" y1="303.6387" y2="316.6387"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="487.5" x2="528.5" y1="316.6387" y2="316.6387"/><polygon fill="#A80036" points="497.5,312.6387,487.5,316.6387,497.5,320.6387,493.5,316.6387" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="493.5" y="298.8965">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="506.5" y="298.8965">Filter according to event action</text><path d="M491,329.6387 L491,415.6387 L827,415.6387 L827,339.6387 L817,329.6387 L491,329.6387 " fill="#FBFB77" filter="url(#fgiwom38axpf1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M817,329.6387 L817,339.6387 L827,339.6387 L817,329.6387 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="497" y="347.207">Qualifying event action:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="501" y="362.5176"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="497" y="377.8281">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="299" x="513" y="393.1387">data.value.metadata.event.action === 'commit'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="497" y="408.4492">}</text><path d="M23,432.1914 L85,432.1914 L85,439.1914 L75,449.1914 L23,449.1914 L23,432.1914 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1521.7715" style="stroke: #000000; stroke-width: 2.0;" width="875.5" x="23" y="432.1914"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="445.7598">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="190" x="100" y="444.8262">[Messages event type that qualify]</text><polygon fill="#A80036" points="104.5,482.123,94.5,486.123,104.5,490.123,100.5,486.123" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="98.5" x2="475.5" y1="486.123" y2="486.123"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="110.5" y="473.7256">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="316" x="123.5" y="466.0703">Request notification info for both payee and payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="123.5" y="481.3809">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="207.5" y="481.3809">2001, 2003</text><polygon fill="#A80036" points="825.5,541.4336,835.5,545.4336,825.5,549.4336,829.5,545.4336" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="486.5" x2="831.5" y1="545.4336" y2="545.4336"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="493.5" y="540.6914">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="506.5" y="540.6914">Persist message related data to CEP store</text><polygon fill="#FFFFE0" filter="url(#fgiwom38axpf1)" points="820,588.4336,865,588.4336,875,599.4336,865,611.4336,820,611.4336,810,599.4336,820,588.4336" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="822" y="605.002">events</text><polygon fill="#A80036" points="104.5,649.3652,94.5,653.3652,104.5,657.3652,100.5,653.3652" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="98.5" x2="475.5" y1="653.3652" y2="653.3652"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="110.5" y="640.9678">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="351" x="123.5" y="633.3125">Request current positions info for both payee and payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="123.5" y="648.623">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="207.5" y="648.623">2001, 2003</text><polygon fill="#A80036" points="825.5,708.6758,835.5,712.6758,825.5,716.6758,829.5,712.6758" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="486.5" x2="831.5" y1="712.6758" y2="712.6758"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="493.5" y="707.9336">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="506.5" y="707.9336">Request current limits</text><polygon fill="#FFFFE0" filter="url(#fgiwom38axpf1)" points="822,725.6758,862,725.6758,872,736.6758,862,748.6758,822,748.6758,812,736.6758,822,725.6758" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="824" y="742.2441">limits</text><path d="M491,758.9863 L491,813.9863 L669,813.9863 L669,768.9863 L659,758.9863 L491,758.9863 " fill="#D3D3D3" filter="url(#fgiwom38axpf1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M659,758.9863 L659,768.9863 L669,768.9863 L659,758.9863 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="497" y="776.5547">API call to CEP Store</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="497" y="791.8652">requesting current</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="37" x="617" y="791.8652">limits</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="497" y="807.1758">for</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="519" y="807.1758">payee</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="564" y="807.1758">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="591" y="807.1758">payer</text><polygon fill="#A80036" points="497.5,841.2285,487.5,845.2285,497.5,849.2285,493.5,845.2285" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="491.5" x2="841.5" y1="845.2285" y2="845.2285"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="503.5" y="840.4863">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="516.5" y="840.4863">Return results current limits</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="486.5" x2="528.5" y1="874.5391" y2="874.5391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="528.5" x2="528.5" y1="874.5391" y2="887.5391"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="487.5" x2="528.5" y1="887.5391" y2="887.5391"/><polygon fill="#A80036" points="497.5,883.5391,487.5,887.5391,497.5,891.5391,493.5,887.5391" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="493.5" y="869.7969">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="510.5" y="869.7969"/><path d="M491,900.5391 L491,955.5391 L759,955.5391 L759,910.5391 L749,900.5391 L491,900.5391 " fill="#D3D3D3" filter="url(#fgiwom38axpf1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M749,900.5391 L749,910.5391 L759,910.5391 L749,900.5391 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="497" y="918.1074">Calculate the current</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="65" x="632" y="918.1074">threshold</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="497" y="933.418">percentage</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="578" y="933.418">for both</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="633" y="933.418">payee</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="678" y="933.418">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="705" y="933.418">payer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="497" y="948.7285">for all</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="538" y="948.7285">currencies</text><polygon fill="#A80036" points="825.5,982.7813,835.5,986.7813,825.5,990.7813,829.5,986.7813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="486.5" x2="831.5" y1="986.7813" y2="986.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="493.5" y="982.0391">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="300" x="506.5" y="982.0391">Persist new position with threshold information</text><polygon fill="#FFFFE0" filter="url(#fgiwom38axpf1)" points="822,1029.7813,862,1029.7813,872,1040.7813,862,1052.7813,822,1052.7813,812,1040.7813,822,1029.7813" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="824" y="1046.3496">limits</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="486.5" x2="528.5" y1="1079.4023" y2="1079.4023"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="528.5" x2="528.5" y1="1079.4023" y2="1092.4023"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="487.5" x2="528.5" y1="1092.4023" y2="1092.4023"/><polygon fill="#A80036" points="497.5,1088.4023,487.5,1092.4023,497.5,1096.4023,493.5,1092.4023" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="493.5" y="1074.6602">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="519.5" y="1074.6602"/><path d="M491,1105.4023 L491,1145.4023 L631,1145.4023 L631,1115.4023 L621,1105.4023 L491,1105.4023 " fill="#D3D3D3" filter="url(#fgiwom38axpf1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M621,1105.4023 L621,1115.4023 L631,1115.4023 L621,1105.4023 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="497" y="1122.9707">Evaluate 'facts'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="497" y="1138.2813">Invoke Rule Engine</text><path d="M377.5,1162.0234 L439.5,1162.0234 L439.5,1169.0234 L429.5,1179.0234 L377.5,1179.0234 L377.5,1162.0234 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="769.9844" style="stroke: #000000; stroke-width: 2.0;" width="511" x="377.5" y="1162.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="392.5" y="1175.5918">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="454.5" y="1174.6582">[Threshold is breached]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="486.5" x2="528.5" y1="1200.6445" y2="1200.6445"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="528.5" x2="528.5" y1="1200.6445" y2="1213.6445"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="487.5" x2="528.5" y1="1213.6445" y2="1213.6445"/><polygon fill="#A80036" points="497.5,1209.6445,487.5,1213.6445,497.5,1217.6445,493.5,1213.6445" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="493.5" y="1195.9023">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="519.5" y="1195.9023"/><path d="M491,1226.6445 L491,1251.6445 L680,1251.6445 L680,1236.6445 L670,1226.6445 L491,1226.6445 " fill="#D3D3D3" filter="url(#fgiwom38axpf1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M670,1226.6445 L670,1236.6445 L680,1236.6445 L670,1226.6445 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="497" y="1244.2129">Create new</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="570" y="1244.2129">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="661" y="1244.2129">.</text><rect fill="#FFFFFF" filter="url(#fgiwom38axpf1)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="287" x="394.5" y="1260.9551"/><polygon fill="#EEEEEE" points="394.5,1260.9551,458.5,1260.9551,458.5,1267.9551,448.5,1277.9551,394.5,1277.9551,394.5,1260.9551" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="407.5" y="1275.5234">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="400.5" y="1294.5234">Notification Action Flow {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/central-event-processor/tree/master/docs/sequenceDiagrams/seq-cep-10.4-action-flow.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/central-event-processor/tree/master/docs/sequenceDiagrams/seq-cep-10.4-action-flow.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="110" x="561.5" y="1294.5234">10.4-action-flow</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="561.5" x2="671.5" y1="1296.5234" y2="1296.5234"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="671.5" y="1294.5234">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="404.5" y="1309.834"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="377.5" x2="888.5" y1="1322.8867" y2="1322.8867"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="219" x="382.5" y="1333.5215">[Threshold not breached - same event]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="486.5" x2="528.5" y1="1358.1523" y2="1358.1523"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="528.5" x2="528.5" y1="1358.1523" y2="1371.1523"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="487.5" x2="528.5" y1="1371.1523" y2="1371.1523"/><polygon fill="#A80036" points="497.5,1367.1523,487.5,1371.1523,497.5,1375.1523,493.5,1371.1523" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="493.5" y="1353.4102">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="519.5" y="1353.4102"/><path d="M491,1384.1523 L491,1409.1523 L784,1409.1523 L784,1394.1523 L774,1384.1523 L491,1384.1523 " fill="#D3D3D3" filter="url(#fgiwom38axpf1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M774,1384.1523 L774,1394.1523 L784,1394.1523 L774,1384.1523 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="497" y="1401.7207">Send finish</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="571" y="1401.7207">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="666" y="1401.7207">to Action Agent.</text><polygon fill="#A80036" points="825.5,1435.7734,835.5,1439.7734,825.5,1443.7734,829.5,1439.7734" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="486.5" x2="831.5" y1="1439.7734" y2="1439.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="493.5" y="1435.0313">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="515.5" y="1435.0313">Request</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="569.5" y="1435.0313">Action Object</text><path d="M491,1452.7734 L491,1492.7734 L715,1492.7734 L715,1462.7734 L705,1452.7734 L491,1452.7734 " fill="#D3D3D3" filter="url(#fgiwom38axpf1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M705,1452.7734 L705,1462.7734 L715,1462.7734 L705,1452.7734 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="497" y="1470.3418">Request previous</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="609" y="1470.3418">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="497" y="1485.6523">with same event details</text><polygon fill="#FFFFE0" filter="url(#fgiwom38axpf1)" points="821,1507.3945,864,1507.3945,874,1518.3945,864,1530.3945,821,1530.3945,811,1518.3945,821,1507.3945" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="823" y="1523.9629">action</text><polygon fill="#A80036" points="497.5,1553.0156,487.5,1557.0156,497.5,1561.0156,493.5,1557.0156" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="491.5" x2="841.5" y1="1557.0156" y2="1557.0156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="503.5" y="1552.2734">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="525.5" y="1552.2734">Return results</text><path d="M491,1570.0156 L491,1702.0156 L713,1702.0156 L713,1580.0156 L703,1570.0156 L491,1570.0156 " fill="#FBFB77" filter="url(#fgiwom38axpf1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M703,1570.0156 L703,1580.0156 L713,1580.0156 L703,1570.0156 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="497" y="1587.584">Event details for</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="603" y="1587.584">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="694" y="1587.584">:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="501" y="1602.8945"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="497" y="1618.2051">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="513" y="1633.5156">limit type</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="513" y="1648.8262">currency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="513" y="1664.1367">dfsp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="513" y="1679.4473">notification endpoint type</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="497" y="1694.7578">}</text><path d="M387.5,1718.5 L449.5,1718.5 L449.5,1725.5 L439.5,1735.5 L387.5,1735.5 L387.5,1718.5 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="113.8867" style="stroke: #000000; stroke-width: 2.0;" width="380.5" x="387.5" y="1718.5"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="402.5" y="1732.0684">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="109" x="464.5" y="1731.1348">[Action Event exist]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="486.5" x2="528.5" y1="1757.1211" y2="1757.1211"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="528.5" x2="528.5" y1="1757.1211" y2="1770.1211"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="487.5" x2="528.5" y1="1770.1211" y2="1770.1211"/><polygon fill="#A80036" points="497.5,1766.1211,487.5,1770.1211,497.5,1774.1211,493.5,1770.1211" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="493.5" y="1752.3789">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="519.5" y="1752.3789"/><path d="M491,1783.1211 L491,1808.1211 L754,1808.1211 L754,1793.1211 L744,1783.1211 L491,1783.1211 " fill="#D3D3D3" filter="url(#fgiwom38axpf1)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M744,1783.1211 L744,1793.1211 L754,1793.1211 L744,1783.1211 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="497" y="1800.6895">Deactive pending</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="610" y="1800.6895">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="705" y="1800.6895">event</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="387.5" x2="768" y1="1818.4316" y2="1818.4316"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="161" x="392.5" y="1829.0664">[Action Event does not exist]</text><polygon fill="#A80036" points="825.5,1856.6973,835.5,1860.6973,825.5,1864.6973,829.5,1860.6973" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="486.5" x2="831.5" y1="1860.6973" y2="1860.6973"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="493.5" y="1855.9551">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="515.5" y="1855.9551">Persist updated</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="616.5" y="1855.9551">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="711.5" y="1855.9551">event to CEP Store</text><polygon fill="#FFFFE0" filter="url(#fgiwom38axpf1)" points="821,1903.6973,864,1903.6973,874,1914.6973,864,1926.6973,821,1926.6973,811,1914.6973,821,1903.6973" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="823" y="1920.2656">action</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="898.5" y1="1940.0078" y2="1940.0078"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="278" x="28" y="1950.6426">[Message does not qualify for notification action]</text><!--
@startuml
title 10.3. Notification Limit Position Breach Rule Validation
autonumber

collections "Notification-Topic" as topicNotify
boundary "Central-Ledger\nAdmin API" as CLAPI
control "Central Event Processor" as CEP
database "CEP Store" as DB

box "Central Services" #LightYellow
participant CLAPI
participant topicNotify
end box
box "Central Event Processing Services" #LightGreen
participant CEP
participant DB
end box

Group Limit Position Breach
    activate CEP
    note right of topicNotify #LightGrey
        Events are published
        to Notification Topic
        by Central Services
    end note
    topicNotify <- CEP: Consumes notification messages
    activate topicNotify
    deactivate topicNotify
    CEP -> CEP: Filter according to event action
    note right of CEP
        Qualifying event action:

        {
            data.value.metadata.event.action === 'commit'
        }
    end note

    alt Messages event type that qualify
        CLAPI <- CEP: Request notification info for both payee and payer\n<color #FF0000><b>Error codes:</b> 2001, 2003 </color>
        activate CLAPI
        deactivate CLAPI
        CEP -> DB: Persist message related data to CEP store
        activate DB
        hnote over DB #LightYellow
            events
        end hnote
        deactivate DB
        CLAPI <- CEP: Request current positions info for both payee and payer\n<color #FF0000><b>Error codes:</b> 2001, 2003 </color>
        activate CLAPI
        deactivate CLAPI
        CEP -> DB: Request current limits
        activate DB
        hnote over DB #LightYellow
            limits
        end hnote
        note right of CEP #LightGrey
            API call to CEP Store
            requesting current **limits**
            for **payee** and **payer**
        end note
        CEP <- - DB: Return results current limits
        deactivate DB
        CEP -> CEP:
        note right of CEP #LightGrey
            Calculate the current **threshold**
            **percentage** for both **payee** and **payer**
            for all **currencies**
        end note
        CEP -> DB: Persist new position with threshold information
        activate DB
        hnote over DB #LightYellow
            limits
        end hnote
        deactivate DB
        CEP -> CEP
        note right of CEP #LightGrey
            Evaluate 'facts'
            Invoke Rule Engine
        end note

        alt Threshold is breached
            CEP -> CEP
            note right of CEP #LightGrey
                Create new **Action Object**.
            end note
            ref over CEP :  Notification Action Flow {[[https://github.com/mojaloop/central-event-processor/tree/master/docs/sequenceDiagrams/seq-cep-10.4-action-flow.svg 10.4-action-flow]]} \n
        else Threshold not breached - same event
            CEP -> CEP
            note right of CEP #LightGrey
                Send finish **Action Object** to Action Agent.
            end note
            CEP -> DB: Request **Action Object**
            note right of CEP #LightGrey
                Request previous **Action Object**
                with same event details
            end note
            activate DB
        hnote over DB #LightYellow
            action
        end hnote
        CEP <- - DB: Return results
        deactivate DB
            note right of CEP
                Event details for **Action Object**:

                {
                    limit type
                    currency
                    dfsp
                    notification endpoint type
                }
            end note
            alt Action Event exist
                CEP -> CEP
                note right of CEP #LightGrey
                    Deactive pending **Action Object** event
                end note
            else Action Event does not exist
            end
        CEP -> DB: Persist updated **Action Object** event to CEP Store
        activate DB
        hnote over DB #LightYellow
            action
        end hnote
        deactivate DB
        end
    else Message does not qualify for notification action
    end
    deactivate CEP
end
@enduml

PlantUML version 1.2018.11(Sat Sep 22 18:43:53 SAST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1343-b26
Operating System: Mac OS X
OS Version: 10.14.2
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>