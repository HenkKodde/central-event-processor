<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2036px" preserveAspectRatio="none" style="width:936px;height:2036px;" version="1.1" viewBox="0 0 936 2036" width="936px" zoomAndPan="magnify"><defs><filter height="300%" id="f1nm2iyj3i7gjc" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="400" x="269.25" y="23.5352">10.3. Notification Limit Position Breach Rule Validation</text><rect fill="#FFFFE0" height="1991.1641" style="stroke: #A80036; stroke-width: 1.0;" width="296" x="29" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="123" y="47.0566">Central Services</text><rect fill="#90EE90" height="1991.1641" style="stroke: #A80036; stroke-width: 1.0;" width="489" x="410.5" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="227" x="541.5" y="47.0566">Central Event Processing Services</text><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="93.5" y="483.6348"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="93.5" y="650.877"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="242.5" y="241.8398"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="1816.877" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="493.5" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="854.5" y="542.9453"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="132.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="854.5" y="710.1875"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="854.5" y="984.293"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="117.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="854.5" y="1437.2852"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="854.5" y="1842.8984"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="1809.877" style="stroke: #000000; stroke-width: 2.0;" width="912.5" x="13" y="133.2871"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="1506.4609" style="stroke: #000000; stroke-width: 2.0;" width="892.5" x="23" y="429.7031"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="754.6738" style="stroke: #000000; stroke-width: 2.0;" width="511" x="394.5" y="1159.5352"/><rect fill="#FFFFFF" height="594.8105" style="stroke: none; stroke-width: 1.0;" width="511" x="394.5" y="1319.3984"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="113.8867" style="stroke: #000000; stroke-width: 2.0;" width="380.5" x="404.5" y="1700.7012"/><rect fill="#FFFFFF" height="14.9551" style="stroke: none; stroke-width: 1.0;" width="380.5" x="404.5" y="1799.6328"/><rect fill="#FFFFFF" height="14.9551" style="stroke: none; stroke-width: 1.0;" width="892.5" x="23" y="1921.209"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="98" x2="98" y1="116.2871" y2="1960.1641"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="247" x2="247" y1="116.2871" y2="1960.1641"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="498.5" x2="498.5" y1="116.2871" y2="1960.1641"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="859.5" x2="859.5" y1="116.2871" y2="1960.1641"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="33" y="113.334">Central Admin API</text><path d="M78,71.7988 L78,95.7988 M78,83.7988 L95,83.7988 " fill="none" filter="url(#f1nm2iyj3i7gjc)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="107" cy="83.7988" fill="#FEFECE" filter="url(#f1nm2iyj3i7gjc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="33" y="1972.6992">Central Admin API</text><path d="M78,1979.6523 L78,2003.6523 M78,1991.6523 L95,1991.6523 " fill="none" filter="url(#f1nm2iyj3i7gjc)" style="stroke: #A80036; stroke-width: 2.0;"/><ellipse cx="107" cy="1991.6523" fill="#FEFECE" filter="url(#f1nm2iyj3i7gjc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1nm2iyj3i7gjc)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="178" y="76.7988"/><rect fill="#FEFECE" filter="url(#f1nm2iyj3i7gjc)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="174" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="181" y="101.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1nm2iyj3i7gjc)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="178" y="1959.1641"/><rect fill="#FEFECE" filter="url(#f1nm2iyj3i7gjc)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="174" y="1963.1641"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="181" y="1983.6992">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="162" x="414.5" y="113.334">Central Event Processor</text><ellipse cx="498.5" cy="83.7988" fill="#FEFECE" filter="url(#f1nm2iyj3i7gjc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="494.5,71.7988,500.5,66.7988,498.5,71.7988,500.5,76.7988,494.5,71.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="162" x="414.5" y="1972.6992">Central Event Processor</text><ellipse cx="498.5" cy="1991.6523" fill="#FEFECE" filter="url(#f1nm2iyj3i7gjc)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="494.5,1979.6523,500.5,1974.6523,498.5,1979.6523,500.5,1984.6523,494.5,1979.6523" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="823.5" y="113.334">CEP Store</text><path d="M841.5,63.7988 C841.5,53.7988 859.5,53.7988 859.5,53.7988 C859.5,53.7988 877.5,53.7988 877.5,63.7988 L877.5,89.7988 C877.5,99.7988 859.5,99.7988 859.5,99.7988 C859.5,99.7988 841.5,99.7988 841.5,89.7988 L841.5,63.7988 " fill="#FEFECE" filter="url(#f1nm2iyj3i7gjc)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M841.5,63.7988 C841.5,73.7988 859.5,73.7988 859.5,73.7988 C859.5,73.7988 877.5,73.7988 877.5,63.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="823.5" y="1972.6992">CEP Store</text><path d="M841.5,1985.6523 C841.5,1975.6523 859.5,1975.6523 859.5,1975.6523 C859.5,1975.6523 877.5,1975.6523 877.5,1985.6523 L877.5,2011.6523 C877.5,2021.6523 859.5,2021.6523 859.5,2021.6523 C859.5,2021.6523 841.5,2021.6523 841.5,2011.6523 L841.5,1985.6523 " fill="#FEFECE" filter="url(#f1nm2iyj3i7gjc)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M841.5,1985.6523 C841.5,1995.6523 859.5,1995.6523 859.5,1995.6523 C859.5,1995.6523 877.5,1995.6523 877.5,1985.6523 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="93.5" y="483.6348"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="93.5" y="650.877"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="242.5" y="241.8398"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="1816.877" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="493.5" y="126.2871"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="854.5" y="542.9453"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="132.5527" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="854.5" y="710.1875"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="854.5" y="984.293"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="117.2422" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="854.5" y="1437.2852"/><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="854.5" y="1842.8984"/><path d="M13,133.2871 L199,133.2871 L199,140.2871 L189,150.2871 L13,150.2871 L13,133.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1809.877" style="stroke: #000000; stroke-width: 2.0;" width="912.5" x="13" y="133.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="141" x="28" y="146.8555">Limit Position Breach</text><path d="M252,155.5977 L252,210.5977 L404,210.5977 L404,165.5977 L394,155.5977 L252,155.5977 " fill="#D3D3D3" filter="url(#f1nm2iyj3i7gjc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M394,155.5977 L394,165.5977 L404,165.5977 L394,155.5977 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="258" y="173.166">Events are published</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="258" y="188.4766">to Notification Topic</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="258" y="203.7871">by Central Services</text><polygon fill="#A80036" points="263.5,237.8398,253.5,241.8398,263.5,245.8398,259.5,241.8398" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="257.5" x2="492.5" y1="241.8398" y2="241.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="269.5" y="237.0977">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="209" x="282.5" y="237.0977">Consumes notification messages</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="503.5" x2="545.5" y1="301.1504" y2="301.1504"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="545.5" x2="545.5" y1="301.1504" y2="314.1504"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="504.5" x2="545.5" y1="314.1504" y2="314.1504"/><polygon fill="#A80036" points="514.5,310.1504,504.5,314.1504,514.5,318.1504,510.5,314.1504" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="510.5" y="296.4082">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="196" x="523.5" y="296.4082">Filter according to event action</text><path d="M508,327.1504 L508,413.1504 L844,413.1504 L844,337.1504 L834,327.1504 L508,327.1504 " fill="#FBFB77" filter="url(#f1nm2iyj3i7gjc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M834,327.1504 L834,337.1504 L844,337.1504 L834,327.1504 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="514" y="344.7188">Qualifying event action</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="518" y="360.0293"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="514" y="375.3398">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="299" x="530" y="390.6504">data.value.metadata.event.action === 'commit'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="514" y="405.9609">}</text><path d="M23,429.7031 L85,429.7031 L85,436.7031 L75,446.7031 L23,446.7031 L23,429.7031 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1506.4609" style="stroke: #000000; stroke-width: 2.0;" width="892.5" x="23" y="429.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="38" y="443.2715">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="190" x="100" y="442.3379">[Messages event type that qualify]</text><polygon fill="#A80036" points="114.5,479.6348,104.5,483.6348,114.5,487.6348,110.5,483.6348" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="108.5" x2="492.5" y1="483.6348" y2="483.6348"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="120.5" y="471.2373">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="316" x="133.5" y="463.582">Request notification info for both payee and payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="133.5" y="478.8926">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="217.5" y="478.8926">2001, 2003</text><polygon fill="#A80036" points="842.5,538.9453,852.5,542.9453,842.5,546.9453,846.5,542.9453" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="503.5" x2="848.5" y1="542.9453" y2="542.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="510.5" y="538.2031">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="523.5" y="538.2031">Persist message related data to CEP store</text><polygon fill="#FFFFE0" filter="url(#f1nm2iyj3i7gjc)" points="837,585.9453,882,585.9453,892,596.9453,882,608.9453,837,608.9453,827,596.9453,837,585.9453" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="839" y="602.5137">events</text><polygon fill="#A80036" points="114.5,646.877,104.5,650.877,114.5,654.877,110.5,650.877" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="108.5" x2="492.5" y1="650.877" y2="650.877"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="120.5" y="638.4795">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="351" x="133.5" y="630.8242">Request current positions info for both payee and payer</text><text fill="#FF0000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="133.5" y="646.1348">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="217.5" y="646.1348">2001, 2003</text><polygon fill="#A80036" points="842.5,706.1875,852.5,710.1875,842.5,714.1875,846.5,710.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="503.5" x2="848.5" y1="710.1875" y2="710.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="510.5" y="705.4453">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="523.5" y="705.4453">Request current limits</text><polygon fill="#FFFFE0" filter="url(#f1nm2iyj3i7gjc)" points="839,723.1875,879,723.1875,889,734.1875,879,746.1875,839,746.1875,829,734.1875,839,723.1875" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="841" y="739.7559">limits</text><path d="M508,756.498 L508,811.498 L686,811.498 L686,766.498 L676,756.498 L508,756.498 " fill="#D3D3D3" filter="url(#f1nm2iyj3i7gjc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M676,756.498 L676,766.498 L686,766.498 L676,756.498 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="514" y="774.0664">API call to CEP Store</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="116" x="514" y="789.377">requesting current</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="37" x="634" y="789.377">limits</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="18" x="514" y="804.6875">for</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="536" y="804.6875">payee</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="581" y="804.6875">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="608" y="804.6875">payer</text><polygon fill="#A80036" points="514.5,838.7402,504.5,842.7402,514.5,846.7402,510.5,842.7402" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="508.5" x2="858.5" y1="842.7402" y2="842.7402"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="520.5" y="837.998">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="177" x="533.5" y="837.998">Return results current limits</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="503.5" x2="545.5" y1="872.0508" y2="872.0508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="545.5" x2="545.5" y1="872.0508" y2="885.0508"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="504.5" x2="545.5" y1="885.0508" y2="885.0508"/><polygon fill="#A80036" points="514.5,881.0508,504.5,885.0508,514.5,889.0508,510.5,885.0508" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="510.5" y="867.3086">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="527.5" y="867.3086"/><path d="M508,898.0508 L508,953.0508 L776,953.0508 L776,908.0508 L766,898.0508 L508,898.0508 " fill="#D3D3D3" filter="url(#f1nm2iyj3i7gjc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M766,898.0508 L766,908.0508 L776,908.0508 L766,898.0508 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="514" y="915.6191">Calculate the current</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="65" x="649" y="915.6191">threshold</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="77" x="514" y="930.9297">percentage</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="51" x="595" y="930.9297">for both</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="41" x="650" y="930.9297">payee</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="695" y="930.9297">and</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="722" y="930.9297">payer</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="37" x="514" y="946.2402">for all</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="555" y="946.2402">currencies</text><polygon fill="#A80036" points="842.5,980.293,852.5,984.293,842.5,988.293,846.5,984.293" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="503.5" x2="848.5" y1="984.293" y2="984.293"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="510.5" y="979.5508">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="300" x="523.5" y="979.5508">Persist new position with threshold information</text><polygon fill="#FFFFE0" filter="url(#f1nm2iyj3i7gjc)" points="839,1027.293,879,1027.293,889,1038.293,879,1050.293,839,1050.293,829,1038.293,839,1027.293" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="36" x="841" y="1043.8613">limits</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="503.5" x2="545.5" y1="1076.9141" y2="1076.9141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="545.5" x2="545.5" y1="1076.9141" y2="1089.9141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="504.5" x2="545.5" y1="1089.9141" y2="1089.9141"/><polygon fill="#A80036" points="514.5,1085.9141,504.5,1089.9141,514.5,1093.9141,510.5,1089.9141" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="510.5" y="1072.1719">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="536.5" y="1072.1719"/><path d="M508,1102.9141 L508,1142.9141 L648,1142.9141 L648,1112.9141 L638,1102.9141 L508,1102.9141 " fill="#D3D3D3" filter="url(#f1nm2iyj3i7gjc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M638,1102.9141 L638,1112.9141 L648,1112.9141 L638,1102.9141 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="514" y="1120.4824">Evaluate 'facts'</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="514" y="1135.793">Invoke Rule Engine</text><path d="M394.5,1159.5352 L456.5,1159.5352 L456.5,1166.5352 L446.5,1176.5352 L394.5,1176.5352 L394.5,1159.5352 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="754.6738" style="stroke: #000000; stroke-width: 2.0;" width="511" x="394.5" y="1159.5352"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="409.5" y="1173.1035">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="133" x="471.5" y="1172.1699">[Threshold is breached]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="503.5" x2="545.5" y1="1198.1563" y2="1198.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="545.5" x2="545.5" y1="1198.1563" y2="1211.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="504.5" x2="545.5" y1="1211.1563" y2="1211.1563"/><polygon fill="#A80036" points="514.5,1207.1563,504.5,1211.1563,514.5,1215.1563,510.5,1211.1563" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="510.5" y="1193.4141">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="536.5" y="1193.4141"/><path d="M508,1224.1563 L508,1249.1563 L697,1249.1563 L697,1234.1563 L687,1224.1563 L508,1224.1563 " fill="#D3D3D3" filter="url(#f1nm2iyj3i7gjc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M687,1224.1563 L687,1234.1563 L697,1234.1563 L687,1224.1563 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="514" y="1241.7246">Create new</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="587" y="1241.7246">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="678" y="1241.7246">.</text><rect fill="#FFFFFF" filter="url(#f1nm2iyj3i7gjc)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="251" x="411.5" y="1258.4668"/><polygon fill="#EEEEEE" points="411.5,1258.4668,475.5,1258.4668,475.5,1265.4668,465.5,1275.4668,411.5,1275.4668,411.5,1258.4668" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="424.5" y="1273.0352">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="417.5" y="1292.0352">Notification Action Flow {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/central-event-processor/tree/master/docs/sequence_diagrams/notification-actionFlow.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/central-event-processor/tree/master/docs/sequence_diagrams/notification-actionFlow.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="74" x="578.5" y="1292.0352">Action Flow</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="578.5" x2="652.5" y1="1294.0352" y2="1294.0352"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="652.5" y="1292.0352">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="421.5" y="1307.3457"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="394.5" x2="905.5" y1="1320.3984" y2="1320.3984"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="219" x="399.5" y="1331.0332">[Threshold not breached - same event]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="503.5" x2="545.5" y1="1355.6641" y2="1355.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="545.5" x2="545.5" y1="1355.6641" y2="1368.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="504.5" x2="545.5" y1="1368.6641" y2="1368.6641"/><polygon fill="#A80036" points="514.5,1364.6641,504.5,1368.6641,514.5,1372.6641,510.5,1368.6641" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="510.5" y="1350.9219">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="536.5" y="1350.9219"/><path d="M508,1381.6641 L508,1406.6641 L801,1406.6641 L801,1391.6641 L791,1381.6641 L508,1381.6641 " fill="#D3D3D3" filter="url(#f1nm2iyj3i7gjc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M791,1381.6641 L791,1391.6641 L801,1391.6641 L791,1381.6641 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="514" y="1399.2324">Send finish</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="588" y="1399.2324">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="683" y="1399.2324">to Action Agent.</text><polygon fill="#A80036" points="842.5,1433.2852,852.5,1437.2852,842.5,1441.2852,846.5,1437.2852" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="503.5" x2="848.5" y1="1437.2852" y2="1437.2852"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="510.5" y="1432.543">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="532.5" y="1432.543">Request</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="586.5" y="1432.543">Action Object</text><path d="M508,1450.2852 L508,1490.2852 L732,1490.2852 L732,1460.2852 L722,1450.2852 L508,1450.2852 " fill="#D3D3D3" filter="url(#f1nm2iyj3i7gjc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M722,1450.2852 L722,1460.2852 L732,1460.2852 L722,1450.2852 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="514" y="1467.8535">Request previous</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="626" y="1467.8535">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="514" y="1483.1641">with same event details</text><polygon fill="#FFFFE0" filter="url(#f1nm2iyj3i7gjc)" points="838,1504.9063,881,1504.9063,891,1515.9063,881,1527.9063,838,1527.9063,828,1515.9063,838,1504.9063" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="840" y="1521.4746">action</text><polygon fill="#A80036" points="514.5,1550.5273,504.5,1554.5273,514.5,1558.5273,510.5,1554.5273" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="508.5" x2="858.5" y1="1554.5273" y2="1554.5273"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="520.5" y="1549.7852">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="542.5" y="1549.7852">Return results</text><path d="M508,1567.5273 L508,1684.5273 L726,1684.5273 L726,1577.5273 L716,1567.5273 L508,1567.5273 " fill="#FBFB77" filter="url(#f1nm2iyj3i7gjc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M716,1567.5273 L716,1577.5273 L726,1577.5273 L716,1567.5273 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="102" x="514" y="1585.0957">Event details for</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="620" y="1585.0957">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="514" y="1600.4063">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="530" y="1615.7168">limit type</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="530" y="1631.0273">currency</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="28" x="530" y="1646.3379">dfsp</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="530" y="1661.6484">notification endpoint type</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="514" y="1676.959">}</text><path d="M404.5,1700.7012 L466.5,1700.7012 L466.5,1707.7012 L456.5,1717.7012 L404.5,1717.7012 L404.5,1700.7012 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="113.8867" style="stroke: #000000; stroke-width: 2.0;" width="380.5" x="404.5" y="1700.7012"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="17" x="419.5" y="1714.2695">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="109" x="481.5" y="1713.3359">[Action Event exist]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="503.5" x2="545.5" y1="1739.3223" y2="1739.3223"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="545.5" x2="545.5" y1="1739.3223" y2="1752.3223"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="504.5" x2="545.5" y1="1752.3223" y2="1752.3223"/><polygon fill="#A80036" points="514.5,1748.3223,504.5,1752.3223,514.5,1756.3223,510.5,1752.3223" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="510.5" y="1734.5801">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="536.5" y="1734.5801"/><path d="M508,1765.3223 L508,1790.3223 L771,1790.3223 L771,1775.3223 L761,1765.3223 L508,1765.3223 " fill="#D3D3D3" filter="url(#f1nm2iyj3i7gjc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M761,1765.3223 L761,1775.3223 L771,1775.3223 L761,1765.3223 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="514" y="1782.8906">Deactive pending</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="627" y="1782.8906">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="34" x="722" y="1782.8906">event</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="404.5" x2="785" y1="1800.6328" y2="1800.6328"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="161" x="409.5" y="1811.2676">[Action Event does not exist]</text><polygon fill="#A80036" points="842.5,1838.8984,852.5,1842.8984,842.5,1846.8984,846.5,1842.8984" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="503.5" x2="848.5" y1="1842.8984" y2="1842.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="510.5" y="1838.1563">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="97" x="532.5" y="1838.1563">Persist updated</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="91" x="633.5" y="1838.1563">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="114" x="728.5" y="1838.1563">event to CEP Store</text><polygon fill="#FFFFE0" filter="url(#f1nm2iyj3i7gjc)" points="838,1885.8984,881,1885.8984,891,1896.8984,881,1908.8984,838,1908.8984,828,1896.8984,838,1885.8984" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="39" x="840" y="1902.4668">action</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="23" x2="915.5" y1="1922.209" y2="1922.209"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="278" x="28" y="1932.8438">[Message does not qualify for notification action]</text><!--
@startuml
title 10.3. Notification Limit Position Breach Rule Validation
autonumber

collections "Notification-Topic" as TOPIC_NOTIFY
boundary "Central Admin API" as CLAPI
control "Central Event Processor" as CEP
database "CEP Store" as DB

box "Central Services" #LightYellow
participant CLAPI
participant TOPIC_NOTIFY
end box
box "Central Event Processing Services" #LightGreen
participant CEP
participant DB
end box

Group Limit Position Breach
    activate CEP
    note right of TOPIC_NOTIFY #LightGrey
        Events are published
        to Notification Topic
        by Central Services
    end note
    TOPIC_NOTIFY <- CEP: Consumes notification messages
    activate TOPIC_NOTIFY
    deactivate TOPIC_NOTIFY
    CEP -> CEP: Filter according to event action
    note right of CEP
        Qualifying event action

        {
            data.value.metadata.event.action === 'commit'
        }
    end note

    alt Messages event type that qualify
        CLAPI <- CEP: Request notification info for both payee and payer\n<color #FF0000><b>Error codes:</b> 2001, 2003 </color>
        activate CLAPI
        deactivate CLAPI
        CEP -> DB: Persist message related data to CEP store
        activate DB
        hnote over DB #LightYellow
            events
        end hnote
        deactivate DB
        CLAPI <- CEP: Request current positions info for both payee and payer\n<color #FF0000><b>Error codes:</b> 2001, 2003 </color>
        activate CLAPI
        deactivate CLAPI
        CEP -> DB: Request current limits
        activate DB
        hnote over DB #LightYellow
            limits
        end hnote
        note right of CEP #LightGrey
            API call to CEP Store
            requesting current **limits**
            for **payee** and **payer**
        end note
        CEP <- - DB: Return results current limits
        deactivate DB
        CEP -> CEP:
        note right of CEP #LightGrey
            Calculate the current **threshold**
            **percentage** for both **payee** and **payer**
            for all **currencies**
        end note
        CEP -> DB: Persist new position with threshold information
        activate DB
        hnote over DB #LightYellow
            limits
        end hnote
        deactivate DB
        CEP -> CEP
        note right of CEP #LightGrey
            Evaluate 'facts'
            Invoke Rule Engine
        end note

        alt Threshold is breached
            CEP -> CEP
            note right of CEP #LightGrey
                Create new **Action Object**.
            end note
            ref over CEP :  Notification Action Flow {[[https://github.com/mojaloop/central-event-processor/tree/master/docs/sequence_diagrams/notification-actionFlow.svg Action Flow]]} \n
        else Threshold not breached - same event
            CEP -> CEP
            note right of CEP #LightGrey
                Send finish **Action Object** to Action Agent.
            end note
            CEP -> DB: Request **Action Object**
            note right of CEP #LightGrey
                Request previous **Action Object**
                with same event details
            end note
            activate DB
        hnote over DB #LightYellow
            action
        end hnote
        CEP <- - DB: Return results
        deactivate DB
            note right of CEP
                Event details for **Action Object**
                {
                    limit type
                    currency
                    dfsp
                    notification endpoint type
                }
            end note
            alt Action Event exist
                CEP -> CEP
                note right of CEP #LightGrey
                    Deactive pending **Action Object** event
                end note
            else Action Event does not exist
            end
        CEP -> DB: Persist updated **Action Object** event to CEP Store
        activate DB
        hnote over DB #LightYellow
            action
        end hnote
        deactivate DB
        end
    else Message does not qualify for notification action
    end
    deactivate CEP
end
@enduml

PlantUML version 1.2018.11(Sat Sep 22 18:43:53 SAST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1343-b26
Operating System: Mac OS X
OS Version: 10.14.2
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>