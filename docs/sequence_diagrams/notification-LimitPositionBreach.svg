<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1281.6px" preserveAspectRatio="none" style="width:896px;height:1281px;" version="1.1" viewBox="0 0 896 1281" width="896px" zoomAndPan="magnify"><defs><filter height="300%" id="f1rzzjj993nfhz" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.600000023841858"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="3.200000047683716" dy="3.200000047683716" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="11.2" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="227.2" x="335.4" y="18.8281">10.3. Notification Limit Position Breach</text><rect fill="#FFFFE0" height="1245.4891" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="236.8" x="18.4" y="27.5906"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="86.4" x="93.6" y="37.6453">Central Services</text><rect fill="#90EE90" height="1245.4891" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="423.2" x="443.6" y="27.5906"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="181.6" x="564.4" y="37.6453">Central Event Processing Services</text><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="76.4" y="193.4719"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="195.6" y="374.6594"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="195.6" y="507.9016"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="1106.0594" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="510" y="101.0297"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="50.0969" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="830.8" y="422.1078"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="106.0422" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="830.8" y="555.35"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="50.0969" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="830.8" y="774.6344"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="93.7938" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="830.8" y="978.7375"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="50.0969" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="830.8" y="1127.4281"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="1100.4594" style="stroke: #000000; stroke-width: 1.600000023841858;" width="878" x="9.6" y="106.6297"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="869.975" style="stroke: #000000; stroke-width: 1.600000023841858;" width="740.4" x="139.2" y="331.5141"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="313.3453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="463.6" x="408" y="870.5797"/><rect fill="#FFFFFF" height="234.2" style="stroke: none; stroke-width: 0.800000011920929;" width="463.6" x="408" y="949.725"/><rect fill="#FFFFFF" height="11.9641" style="stroke: none; stroke-width: 0.800000011920929;" width="740.4" x="139.2" y="1189.525"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="80" x2="80" y1="93.0297" y2="1220.6891"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="199.2" x2="199.2" y1="93.0297" y2="1220.6891"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="514" x2="514" y1="93.0297" y2="1220.6891"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="834.8" x2="834.8" y1="93.0297" y2="1220.6891"/><rect fill="#FEFECE" filter="url(#f1rzzjj993nfhz)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="24.8" y="61.4391"/><rect fill="#FEFECE" filter="url(#f1rzzjj993nfhz)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="21.6" y="64.6391"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="100" x="27.2" y="81.0672">Notification-Topic</text><rect fill="#FEFECE" filter="url(#f1rzzjj993nfhz)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="24.8" y="1219.8891"/><rect fill="#FEFECE" filter="url(#f1rzzjj993nfhz)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="21.6" y="1223.0891"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="100" x="27.2" y="1239.5172">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="100" x="147.2" y="90.6672">Central Admin API</text><path d="M183.2,57.4391 L183.2,76.6391 M183.2,67.0391 L196.8,67.0391 " fill="none" filter="url(#f1rzzjj993nfhz)" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><ellipse cx="206.4" cy="67.0391" fill="#FEFECE" filter="url(#f1rzzjj993nfhz)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="100" x="147.2" y="1230.7172">Central Admin API</text><path d="M183.2,1236.2797 L183.2,1255.4797 M183.2,1245.8797 L196.8,1245.8797 " fill="none" filter="url(#f1rzzjj993nfhz)" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><ellipse cx="206.4" cy="1245.8797" fill="#FEFECE" filter="url(#f1rzzjj993nfhz)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="129.6" x="446.8" y="90.6672">Central Event Processor</text><path d="M497.6,57.4391 L497.6,76.6391 M497.6,67.0391 L511.2,67.0391 " fill="none" filter="url(#f1rzzjj993nfhz)" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><ellipse cx="520.8" cy="67.0391" fill="#FEFECE" filter="url(#f1rzzjj993nfhz)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="129.6" x="446.8" y="1230.7172">Central Event Processor</text><path d="M497.6,1236.2797 L497.6,1255.4797 M497.6,1245.8797 L511.2,1245.8797 " fill="none" filter="url(#f1rzzjj993nfhz)" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><ellipse cx="520.8" cy="1245.8797" fill="#FEFECE" filter="url(#f1rzzjj993nfhz)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="52.8" x="806" y="90.6672">CEP Store</text><path d="M820.4,51.0391 C820.4,43.0391 834.8,43.0391 834.8,43.0391 C834.8,43.0391 849.2,43.0391 849.2,51.0391 L849.2,71.8391 C849.2,79.8391 834.8,79.8391 834.8,79.8391 C834.8,79.8391 820.4,79.8391 820.4,71.8391 L820.4,51.0391 " fill="#FEFECE" filter="url(#f1rzzjj993nfhz)" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><path d="M820.4,51.0391 C820.4,59.0391 834.8,59.0391 834.8,59.0391 C834.8,59.0391 849.2,59.0391 849.2,51.0391 " fill="none" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="52.8" x="806" y="1230.7172">CEP Store</text><path d="M820.4,1241.0797 C820.4,1233.0797 834.8,1233.0797 834.8,1233.0797 C834.8,1233.0797 849.2,1233.0797 849.2,1241.0797 L849.2,1261.8797 C849.2,1269.8797 834.8,1269.8797 834.8,1269.8797 C834.8,1269.8797 820.4,1269.8797 820.4,1261.8797 L820.4,1241.0797 " fill="#FEFECE" filter="url(#f1rzzjj993nfhz)" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><path d="M820.4,1241.0797 C820.4,1249.0797 834.8,1249.0797 834.8,1249.0797 C834.8,1249.0797 849.2,1249.0797 849.2,1241.0797 " fill="none" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="76.4" y="193.4719"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="195.6" y="374.6594"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="195.6" y="507.9016"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="1106.0594" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="510" y="101.0297"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="50.0969" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="830.8" y="422.1078"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="106.0422" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="830.8" y="555.35"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="50.0969" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="830.8" y="774.6344"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="93.7938" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="830.8" y="978.7375"/><rect fill="#FFFFFF" filter="url(#f1rzzjj993nfhz)" height="50.0969" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="830.8" y="1127.4281"/><path d="M9.6,106.6297 L158.4,106.6297 L158.4,112.2297 L150.4,120.2297 L9.6,120.2297 L9.6,106.6297 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="1100.4594" style="stroke: #000000; stroke-width: 1.600000023841858;" width="878" x="9.6" y="106.6297"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112.8" x="21.6" y="117.4844">Limit Position Breach</text><path d="M17.6,124.4781 L17.6,168.4781 L139.2,168.4781 L139.2,132.4781 L131.2,124.4781 L17.6,124.4781 " fill="#FBFB77" filter="url(#f1rzzjj993nfhz)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M131.2,124.4781 L131.2,132.4781 L139.2,132.4781 L131.2,124.4781 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="104" x="22.4" y="138.5328">Events are published</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="104.8" x="22.4" y="150.7813">to Notification Topic</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="95.2" x="22.4" y="163.0297">by Central Services</text><polygon fill="#A80036" points="93.2,190.2719,85.2,193.4719,93.2,196.6719,90,193.4719" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="88.4" x2="509.2" y1="193.4719" y2="193.4719"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="98" y="189.6781">1</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="167.2" x="108.4" y="189.6781">Consumes notification messages</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="518" x2="551.6" y1="240.9203" y2="240.9203"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="551.6" x2="551.6" y1="240.9203" y2="251.3203"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="518.8" x2="551.6" y1="251.3203" y2="251.3203"/><polygon fill="#A80036" points="526.8,248.1203,518.8,251.3203,526.8,254.5203,523.6,251.3203" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="523.6" y="237.1266">2</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="156.8" x="534" y="237.1266">Filter according to event action</text><path d="M384,261.7203 L384,318.5203 L640,318.5203 L640,269.7203 L632,261.7203 L384,261.7203 " fill="#FBFB77" filter="url(#f1rzzjj993nfhz)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M632,261.7203 L632,269.7203 L640,269.7203 L632,261.7203 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="116.8" x="388.8" y="275.775">Qualifying event action</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="388.8" y="288.0234">{</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="239.2" x="388.8" y="300.2719">data.value.metadata.event.action === 'commit'</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="388.8" y="312.5203">}</text><path d="M139.2,331.5141 L188.8,331.5141 L188.8,337.1141 L180.8,345.1141 L139.2,345.1141 L139.2,331.5141 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="869.975" style="stroke: #000000; stroke-width: 1.600000023841858;" width="740.4" x="139.2" y="331.5141"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13.6" x="151.2" y="342.3688">alt</text><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="152" x="200.8" y="341.6219">[Messages event type that qualify]</text><polygon fill="#A80036" points="212.4,371.4594,204.4,374.6594,212.4,377.8594,209.2,374.6594" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="207.6" x2="509.2" y1="374.6594" y2="374.6594"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="217.2" y="364.7414">3</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="252.8" x="227.6" y="358.6172">Request notification info for both payee and payer</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64" x="227.6" y="370.8656">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="57.6" x="294.8" y="370.8656">2001, 2003</text><polygon fill="#A80036" points="821.2,418.9078,829.2,422.1078,821.2,425.3078,824.4,422.1078" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="518" x2="826" y1="422.1078" y2="422.1078"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="523.6" y="418.3141">4</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="207.2" x="534" y="418.3141">Persist message related data to CEP store</text><polygon fill="#FFFFE0" filter="url(#f1rzzjj993nfhz)" points="816.8,432.5078,852.8,432.5078,860.8,441.3078,852.8,450.9078,816.8,450.9078,808.8,441.3078,816.8,432.5078" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="32.8" x="818.4" y="445.7625">events</text><polygon fill="#A80036" points="526.8,469.0047,518.8,472.2047,526.8,475.4047,523.6,472.2047" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="522" x2="834" y1="472.2047" y2="472.2047"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="531.6" y="468.4109">5</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="70.4" x="542" y="468.4109">Return results</text><polygon fill="#A80036" points="212.4,504.7016,204.4,507.9016,212.4,511.1016,209.2,507.9016" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="207.6" x2="509.2" y1="507.9016" y2="507.9016"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="217.2" y="497.9836">6</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="280.8" x="227.6" y="491.8594">Request current positions info for both payee and payer</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64" x="227.6" y="504.1078">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="57.6" x="294.8" y="504.1078">2001, 2003</text><polygon fill="#A80036" points="821.2,552.15,829.2,555.35,821.2,558.55,824.4,555.35" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="518" x2="826" y1="555.35" y2="555.35"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="523.6" y="551.5563">7</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="111.2" x="534" y="551.5563">Request current limits</text><polygon fill="#FFFFE0" filter="url(#f1rzzjj993nfhz)" points="818.4,565.75,850.4,565.75,858.4,574.55,850.4,584.15,818.4,584.15,810.4,574.55,818.4,565.75" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="28.8" x="820" y="579.0047">limits</text><path d="M521.6,592.3984 L521.6,636.3984 L663.2,636.3984 L663.2,600.3984 L655.2,592.3984 L521.6,592.3984 " fill="#FBFB77" filter="url(#f1rzzjj993nfhz)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M655.2,592.3984 L655.2,600.3984 L663.2,600.3984 L655.2,592.3984 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="100.8" x="526.4" y="606.4531">API call to CEP Store</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="124.8" x="526.4" y="618.7016">requesting current limits</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="98.4" x="526.4" y="630.95">for payee and payer</text><polygon fill="#A80036" points="526.8,658.1922,518.8,661.3922,526.8,664.5922,523.6,661.3922" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="522" x2="834" y1="661.3922" y2="661.3922"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="531.6" y="657.5984">8</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="70.4" x="542" y="657.5984">Return results</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="518" x2="551.6" y1="684.8406" y2="684.8406"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="551.6" x2="551.6" y1="684.8406" y2="695.2406"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="518.8" x2="551.6" y1="695.2406" y2="695.2406"/><polygon fill="#A80036" points="526.8,692.0406,518.8,695.2406,526.8,698.4406,523.6,695.2406" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="523.6" y="681.0469">9</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="257.6" x="534" y="681.0469">Calculate threshold percentage for payee and payer</text><path d="M412,705.6406 L412,749.6406 L612,749.6406 L612,713.6406 L604,705.6406 L412,705.6406 " fill="#FBFB77" filter="url(#f1rzzjj993nfhz)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M604,705.6406 L604,713.6406 L612,713.6406 L604,705.6406 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="156" x="416.8" y="719.6953">Calculate the current threshold</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="183.2" x="416.8" y="731.9438">percentage for both payee and payer</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="84.8" x="416.8" y="744.1922">for all currencies</text><polygon fill="#A80036" points="821.2,771.4344,829.2,774.6344,821.2,777.8344,824.4,774.6344" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="518" x2="826" y1="774.6344" y2="774.6344"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="523.6" y="770.8406">10</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="240" x="541.2" y="770.8406">Persist new position with threshold information</text><polygon fill="#FFFFE0" filter="url(#f1rzzjj993nfhz)" points="818.4,785.0344,850.4,785.0344,858.4,793.8344,850.4,803.4344,818.4,803.4344,810.4,793.8344,818.4,785.0344" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="28.8" x="820" y="798.2891">limits</text><polygon fill="#A80036" points="526.8,821.5313,518.8,824.7313,526.8,827.9313,523.6,824.7313" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="522" x2="834" y1="824.7313" y2="824.7313"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="531.6" y="820.9375">11</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="70.4" x="549.2" y="820.9375">Return results</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="518" x2="551.6" y1="848.1797" y2="848.1797"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="551.6" x2="551.6" y1="848.1797" y2="858.5797"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="518.8" x2="551.6" y1="858.5797" y2="858.5797"/><polygon fill="#A80036" points="526.8,855.3797,518.8,858.5797,526.8,861.7797,523.6,858.5797" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="523.6" y="844.386">12</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="98.4" x="541.2" y="844.386">Invoke rules engine</text><path d="M408,870.5797 L457.6,870.5797 L457.6,876.1797 L449.6,884.1797 L408,884.1797 L408,870.5797 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="313.3453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="463.6" x="408" y="870.5797"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13.6" x="420" y="881.4344">alt</text><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="106.4" x="469.6" y="880.6875">[Threshold is breached]</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="518" x2="551.6" y1="901.4766" y2="901.4766"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="551.6" x2="551.6" y1="901.4766" y2="911.8766"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="518.8" x2="551.6" y1="911.8766" y2="911.8766"/><polygon fill="#A80036" points="526.8,908.6766,518.8,911.8766,526.8,915.0766,523.6,911.8766" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="523.6" y="897.6828">13</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="284" x="541.2" y="897.6828">Create new action object and pass it to the Action Agent</text><path d="M416,922.2766 L416,942.2766 L608,942.2766 L608,930.2766 L600,922.2766 L416,922.2766 " fill="#FBFB77" filter="url(#f1rzzjj993nfhz)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M600,922.2766 L600,930.2766 L608,930.2766 L600,922.2766 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="175.2" x="420.8" y="936.3313">Send finish single to Action Agent.</text><line style="stroke: #000000; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="408" x2="871.6" y1="950.525" y2="950.525"/><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="175.2" x="412" y="959.0328">[Threshold not breached - same event]</text><polygon fill="#A80036" points="821.2,975.5375,829.2,978.7375,821.2,981.9375,824.4,978.7375" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="518" x2="826" y1="978.7375" y2="978.7375"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="523.6" y="974.9438">14</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="132" x="541.2" y="974.9438">Request action from event</text><path d="M521.6,989.1375 L521.6,1021.1375 L823.2,1021.1375 L823.2,997.1375 L815.2,989.1375 L521.6,989.1375 " fill="#FBFB77" filter="url(#f1rzzjj993nfhz)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M815.2,989.1375 L815.2,997.1375 L823.2,997.1375 L815.2,989.1375 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="175.2" x="526.4" y="1003.1922">Request previous action with same</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="284.8" x="526.4" y="1015.4406">limit type, currency, DFSP and notification endpoint type</text><polygon fill="#FFFFE0" filter="url(#f1rzzjj993nfhz)" points="817.6,1032.8344,852,1032.8344,860,1041.6344,852,1051.2344,817.6,1051.2344,809.6,1041.6344,817.6,1032.8344" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="31.2" x="819.2" y="1046.0891">action</text><polygon fill="#A80036" points="526.8,1069.3313,518.8,1072.5313,526.8,1075.7313,523.6,1072.5313" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="522" x2="834" y1="1072.5313" y2="1072.5313"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="531.6" y="1068.7375">15</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="70.4" x="549.2" y="1068.7375">Return results</text><path d="M521.6,1082.9313 L521.6,1102.9313 L658.4,1102.9313 L658.4,1090.9313 L650.4,1082.9313 L521.6,1082.9313 " fill="#FBFB77" filter="url(#f1rzzjj993nfhz)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M650.4,1082.9313 L650.4,1090.9313 L658.4,1090.9313 L650.4,1082.9313 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="120" x="526.4" y="1096.986">deactive pending action</text><polygon fill="#A80036" points="821.2,1124.2281,829.2,1127.4281,821.2,1130.6281,824.4,1127.4281" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="518" x2="826" y1="1127.4281" y2="1127.4281"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="523.6" y="1123.6344">16</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="176" x="541.2" y="1123.6344">Persist updated action to CEP Store</text><polygon fill="#FFFFE0" filter="url(#f1rzzjj993nfhz)" points="817.6,1137.8281,852,1137.8281,860,1146.6281,852,1156.2281,817.6,1156.2281,809.6,1146.6281,817.6,1137.8281" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="31.2" x="819.2" y="1151.0828">action</text><polygon fill="#A80036" points="526.8,1174.325,518.8,1177.525,526.8,1180.725,523.6,1177.525" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="522" x2="834" y1="1177.525" y2="1177.525"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="531.6" y="1173.7313">17</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="70.4" x="549.2" y="1173.7313">Return results</text><line style="stroke: #000000; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="139.2" x2="879.6" y1="1190.325" y2="1190.325"/><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="263.2" x="143.2" y="1198.8328">[Ignore - Message does not qualify for notification action]</text><!--
@startuml
title 10.3. Notification Limit Position Breach
autonumber

collections "Notification-Topic" as TOPIC_NOTIFY
boundary "Central Admin API" as CLAPI
boundary "Central Event Processor" as CEP
database "CEP Store" as DB

box "Central Services" #LightYellow
participant TOPIC_NOTIFY
participant CLAPI
end box
box "Central Event Processing Services" #LightGreen
participant CEP
participant DB
end box

Group Limit Position Breach
    activate CEP
    note over TOPIC_NOTIFY
        Events are published
        to Notification Topic
        by Central Services
    end note
    TOPIC_NOTIFY <- - CEP: Consumes notification messages
    activate TOPIC_NOTIFY
    deactivate TOPIC_NOTIFY
    CEP -> CEP: Filter according to event action
    note over CEP
        Qualifying event action
        {
        data.value.metadata.event.action === 'commit'
        }
    end note

    alt Messages event type that qualify
        CLAPI <- CEP: Request notification info for both payee and payer\n<color #FF0000><b>Error codes:</b> 2001, 2003 </color>
        activate CLAPI
        deactivate CLAPI
        CEP - -> DB: Persist message related data to CEP store
        activate DB
        hnote over DB #LightYellow
            events
        end hnote
        CEP <- - DB: Return results
        deactivate DB
        CLAPI <- CEP: Request current positions info for both payee and payer\n<color #FF0000><b>Error codes:</b> 2001, 2003 </color>
        activate CLAPI
        deactivate CLAPI
        CEP -> DB: Request current limits
        activate DB
        hnote over DB #LightYellow
            limits
        end hnote
        note right of CEP
            API call to CEP Store
            requesting current limits
            for payee and payer
        end note
        CEP <- - DB: Return results
        deactivate DB
        CEP -> CEP: Calculate threshold percentage for payee and payer
        note over of CEP
            Calculate the current threshold
            percentage for both payee and payer
            for all currencies
        end note
        CEP - -> DB: Persist new position with threshold information
        activate DB
        hnote over DB #LightYellow
            limits
        end hnote
        CEP <- - DB: Return results
        deactivate DB
        CEP -> CEP: Invoke rules engine

        alt Threshold is breached
            CEP -> CEP: Create new action object and pass it to the Action Agent
            note over of CEP
                Send finish single to Action Agent.
            end note
        else Threshold not breached - same event
            CEP -> DB: Request action from event
            note right of CEP
                Request previous action with same
                limit type, currency, DFSP and notification endpoint type
            end note
            activate DB
        hnote over DB #LightYellow
            action
        end hnote
        CEP <- - DB: Return results
        deactivate DB
        note right of CEP
            deactive pending action
        end note
        CEP - -> DB: Persist updated action to CEP Store
        activate DB
        hnote over DB #LightYellow
            action
        end hnote
        CEP <- - DB: Return results
        deactivate DB
        end
    else Ignore - Message does not qualify for notification action
    end
    deactivate CEP
end
@enduml

PlantUML version 1.2018.11(Sat Sep 22 18:43:53 SAST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1343-b26
Operating System: Mac OS X
OS Version: 10.14.2
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>