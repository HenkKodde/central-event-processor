<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1628.8px" preserveAspectRatio="none" style="width:748px;height:1628px;" version="1.1" viewBox="0 0 748 1628" width="748.8px" zoomAndPan="magnify"><defs><filter height="300%" id="fxjublhwrxouk" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="1.600000023841858"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="3.200000047683716" dy="3.200000047683716" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="11.2" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="227.2" x="261.8" y="18.8281">10.3. Notification Limit Position Breach</text><rect fill="#FFFFE0" height="1592.9313" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="236.8" x="23.2" y="27.5906"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="86.4" x="98.4" y="37.6453">Central Services</text><rect fill="#90EE90" height="1592.9313" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="391.2" x="328.4" y="27.5906"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="181.6" x="433.2" y="37.6453">Central Event Processing Services</text><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="74.8" y="386.9078"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="74.8" y="520.7016"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="194" y="193.4719"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="1453.5016" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="394.8" y="101.0297"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="683.6" y="434.3563"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="106.0422" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="683.6" y="568.15"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="683.6" y="787.4344"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="93.7938" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="683.6" y="1149.8281"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="683.6" y="1474.3188"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="1447.9016" style="stroke: #000000; stroke-width: 1.600000023841858;" width="730" x="10.4" y="106.6297"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="1205.1688" style="stroke: #000000; stroke-width: 1.600000023841858;" width="714" x="18.4" y="343.7625"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="603.7391" style="stroke: #000000; stroke-width: 1.600000023841858;" width="408.8" x="315.6" y="927.6281"/><rect fill="#FFFFFF" height="475.8484" style="stroke: none; stroke-width: 0.800000011920929;" width="408.8" x="315.6" y="1055.5188"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="91.1094" style="stroke: #000000; stroke-width: 1.600000023841858;" width="304.4" x="323.6" y="1360.561"/><rect fill="#FFFFFF" height="11.9641" style="stroke: none; stroke-width: 0.800000011920929;" width="304.4" x="323.6" y="1439.7063"/><rect fill="#FFFFFF" height="11.9641" style="stroke: none; stroke-width: 0.800000011920929;" width="714" x="18.4" y="1536.9672"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="78.4" x2="78.4" y1="93.0297" y2="1568.1313"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="197.6" x2="197.6" y1="93.0297" y2="1568.1313"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="398.8" x2="398.8" y1="93.0297" y2="1568.1313"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 5.0,5.0;" x1="687.6" x2="687.6" y1="93.0297" y2="1568.1313"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="100" x="26.4" y="90.6672">Central Admin API</text><path d="M62.4,57.4391 L62.4,76.6391 M62.4,67.0391 L76,67.0391 " fill="none" filter="url(#fxjublhwrxouk)" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><ellipse cx="85.6" cy="67.0391" fill="#FEFECE" filter="url(#fxjublhwrxouk)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="100" x="26.4" y="1578.1594">Central Admin API</text><path d="M62.4,1583.7219 L62.4,1602.9219 M62.4,1593.3219 L76,1593.3219 " fill="none" filter="url(#fxjublhwrxouk)" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><ellipse cx="85.6" cy="1593.3219" fill="#FEFECE" filter="url(#fxjublhwrxouk)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><rect fill="#FEFECE" filter="url(#fxjublhwrxouk)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="142.4" y="61.4391"/><rect fill="#FEFECE" filter="url(#fxjublhwrxouk)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="139.2" y="64.6391"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="100" x="144.8" y="81.0672">Notification-Topic</text><rect fill="#FEFECE" filter="url(#fxjublhwrxouk)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="142.4" y="1567.3313"/><rect fill="#FEFECE" filter="url(#fxjublhwrxouk)" height="24.3906" style="stroke: #A80036; stroke-width: 1.2000000178813934;" width="111.2" x="139.2" y="1570.5313"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="100" x="144.8" y="1586.9594">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="129.6" x="331.6" y="90.6672">Central Event Processor</text><ellipse cx="398.8" cy="67.0391" fill="#FEFECE" filter="url(#fxjublhwrxouk)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><polygon fill="#A80036" points="395.6,57.4391,400.4,53.4391,398.8,57.4391,400.4,61.4391,395.6,57.4391" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="129.6" x="331.6" y="1578.1594">Central Event Processor</text><ellipse cx="398.8" cy="1593.3219" fill="#FEFECE" filter="url(#fxjublhwrxouk)" rx="9.6" ry="9.6" style="stroke: #A80036; stroke-width: 1.600000023841858;"/><polygon fill="#A80036" points="395.6,1583.7219,400.4,1579.7219,398.8,1583.7219,400.4,1587.7219,395.6,1583.7219" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="52.8" x="658.8" y="90.6672">CEP Store</text><path d="M673.2,51.0391 C673.2,43.0391 687.6,43.0391 687.6,43.0391 C687.6,43.0391 702,43.0391 702,51.0391 L702,71.8391 C702,79.8391 687.6,79.8391 687.6,79.8391 C687.6,79.8391 673.2,79.8391 673.2,71.8391 L673.2,51.0391 " fill="#FEFECE" filter="url(#fxjublhwrxouk)" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><path d="M673.2,51.0391 C673.2,59.0391 687.6,59.0391 687.6,59.0391 C687.6,59.0391 702,59.0391 702,51.0391 " fill="none" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><text fill="#000000" font-family="sans-serif" font-size="11.2" lengthAdjust="spacingAndGlyphs" textLength="52.8" x="658.8" y="1578.1594">CEP Store</text><path d="M673.2,1588.5219 C673.2,1580.5219 687.6,1580.5219 687.6,1580.5219 C687.6,1580.5219 702,1580.5219 702,1588.5219 L702,1609.3219 C702,1617.3219 687.6,1617.3219 687.6,1617.3219 C687.6,1617.3219 673.2,1617.3219 673.2,1609.3219 L673.2,1588.5219 " fill="#FEFECE" filter="url(#fxjublhwrxouk)" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><path d="M673.2,1588.5219 C673.2,1596.5219 687.6,1596.5219 687.6,1596.5219 C687.6,1596.5219 702,1596.5219 702,1588.5219 " fill="none" style="stroke: #000000; stroke-width: 1.2000000178813934;"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="74.8" y="386.9078"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="74.8" y="520.7016"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="194" y="193.4719"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="1453.5016" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="394.8" y="101.0297"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="683.6" y="434.3563"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="106.0422" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="683.6" y="568.15"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="683.6" y="787.4344"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="93.7938" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="683.6" y="1149.8281"/><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="24" style="stroke: #A80036; stroke-width: 0.800000011920929;" width="8" x="683.6" y="1474.3188"/><path d="M10.4,106.6297 L159.2,106.6297 L159.2,112.2297 L151.2,120.2297 L10.4,120.2297 L10.4,106.6297 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="1447.9016" style="stroke: #000000; stroke-width: 1.600000023841858;" width="730" x="10.4" y="106.6297"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112.8" x="22.4" y="117.4844">Limit Position Breach</text><path d="M201.6,124.4781 L201.6,168.4781 L323.2,168.4781 L323.2,132.4781 L315.2,124.4781 L201.6,124.4781 " fill="#D3D3D3" filter="url(#fxjublhwrxouk)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M315.2,124.4781 L315.2,132.4781 L323.2,132.4781 L315.2,124.4781 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="104" x="206.4" y="138.5328">Events are published</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="104.8" x="206.4" y="150.7813">to Notification Topic</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="95.2" x="206.4" y="163.0297">by Central Services</text><polygon fill="#A80036" points="210.8,190.2719,202.8,193.4719,210.8,196.6719,207.6,193.4719" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="206" x2="394" y1="193.4719" y2="193.4719"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="215.6" y="189.6781">1</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="167.2" x="226" y="189.6781">Consumes notification messages</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="402.8" x2="436.4" y1="240.9203" y2="240.9203"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="436.4" x2="436.4" y1="240.9203" y2="251.3203"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="403.6" x2="436.4" y1="251.3203" y2="251.3203"/><polygon fill="#A80036" points="411.6,248.1203,403.6,251.3203,411.6,254.5203,408.4,251.3203" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="408.4" y="237.1266">2</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="156.8" x="418.8" y="237.1266">Filter according to event action</text><path d="M406.4,261.7203 L406.4,330.5203 L675.2,330.5203 L675.2,269.7203 L667.2,261.7203 L406.4,261.7203 " fill="#FBFB77" filter="url(#fxjublhwrxouk)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M667.2,261.7203 L667.2,269.7203 L675.2,269.7203 L667.2,261.7203 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="116.8" x="411.2" y="275.775">Qualifying event action</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="414.4" y="288.0234"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="411.2" y="300.2719">{</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="239.2" x="424" y="312.5203">data.value.metadata.event.action === 'commit'</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="411.2" y="324.7688">}</text><path d="M18.4,343.7625 L68,343.7625 L68,349.3625 L60,357.3625 L18.4,357.3625 L18.4,343.7625 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="1205.1688" style="stroke: #000000; stroke-width: 1.600000023841858;" width="714" x="18.4" y="343.7625"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13.6" x="30.4" y="354.6172">alt</text><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="152" x="80" y="353.8703">[Messages event type that qualify]</text><polygon fill="#A80036" points="91.6,383.7078,83.6,386.9078,91.6,390.1078,88.4,386.9078" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="86.8" x2="394" y1="386.9078" y2="386.9078"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="96.4" y="376.9898">3</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="252.8" x="106.8" y="370.8656">Request notification info for both payee and payer</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64" x="106.8" y="383.1141">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="57.6" x="174" y="383.1141">2001, 2003</text><polygon fill="#A80036" points="674,431.1563,682,434.3563,674,437.5563,677.2,434.3563" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="402.8" x2="678.8" y1="434.3563" y2="434.3563"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="408.4" y="430.5625">4</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="207.2" x="418.8" y="430.5625">Persist message related data to CEP store</text><polygon fill="#FFFFE0" filter="url(#fxjublhwrxouk)" points="669.6,468.7563,705.6,468.7563,713.6,477.5563,705.6,487.1563,669.6,487.1563,661.6,477.5563,669.6,468.7563" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="32.8" x="671.2" y="482.0109">events</text><polygon fill="#A80036" points="91.6,517.5016,83.6,520.7016,91.6,523.9016,88.4,520.7016" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="86.8" x2="394" y1="520.7016" y2="520.7016"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="96.4" y="510.7836">5</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="280.8" x="106.8" y="504.6594">Request current positions info for both payee and payer</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="64" x="106.8" y="516.9078">Error codes:</text><text fill="#FF0000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="57.6" x="174" y="516.9078">2001, 2003</text><polygon fill="#A80036" points="674,564.95,682,568.15,674,571.35,677.2,568.15" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="402.8" x2="678.8" y1="568.15" y2="568.15"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="408.4" y="564.3563">6</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="111.2" x="418.8" y="564.3563">Request current limits</text><polygon fill="#FFFFE0" filter="url(#fxjublhwrxouk)" points="671.2,578.55,703.2,578.55,711.2,587.35,703.2,596.95,671.2,596.95,663.2,587.35,671.2,578.55" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="28.8" x="672.8" y="591.8047">limits</text><path d="M406.4,605.1984 L406.4,649.1984 L548.8,649.1984 L548.8,613.1984 L540.8,605.1984 L406.4,605.1984 " fill="#D3D3D3" filter="url(#fxjublhwrxouk)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M540.8,605.1984 L540.8,613.1984 L548.8,613.1984 L540.8,605.1984 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="100.8" x="411.2" y="619.2531">API call to CEP Store</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="92.8" x="411.2" y="631.5016">requesting current</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29.6" x="507.2" y="631.5016">limits</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="411.2" y="643.75">for</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32.8" x="428.8" y="643.75">payee</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="18.4" x="464.8" y="643.75">and</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31.2" x="486.4" y="643.75">payer</text><polygon fill="#A80036" points="411.6,670.9922,403.6,674.1922,411.6,677.3922,408.4,674.1922" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="406.8" x2="686.8" y1="674.1922" y2="674.1922"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="416.4" y="670.3984">7</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="141.6" x="426.8" y="670.3984">Return results current limits</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="402.8" x2="436.4" y1="697.6406" y2="697.6406"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="436.4" x2="436.4" y1="697.6406" y2="708.0406"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="403.6" x2="436.4" y1="708.0406" y2="708.0406"/><polygon fill="#A80036" points="411.6,704.8406,403.6,708.0406,411.6,711.2406,408.4,708.0406" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="408.4" y="693.8469">8</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="422" y="693.8469"/><path d="M406.4,718.4406 L406.4,762.4406 L620.8,762.4406 L620.8,726.4406 L612.8,718.4406 L406.4,718.4406 " fill="#D3D3D3" filter="url(#fxjublhwrxouk)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M612.8,718.4406 L612.8,726.4406 L620.8,726.4406 L612.8,718.4406 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="104.8" x="411.2" y="732.4953">Calculate the current</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="52" x="519.2" y="732.4953">threshold</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="61.6" x="411.2" y="744.7438">percentage</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="40.8" x="476" y="744.7438">for both</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32.8" x="520" y="744.7438">payee</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="18.4" x="556" y="744.7438">and</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="31.2" x="577.6" y="744.7438">payer</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="29.6" x="411.2" y="756.9922">for all</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="56.8" x="444" y="756.9922">currencies</text><polygon fill="#A80036" points="674,784.2344,682,787.4344,674,790.6344,677.2,787.4344" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="402.8" x2="678.8" y1="787.4344" y2="787.4344"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="7.2" x="408.4" y="783.6406">9</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="240" x="418.8" y="783.6406">Persist new position with threshold information</text><polygon fill="#FFFFE0" filter="url(#fxjublhwrxouk)" points="671.2,821.8344,703.2,821.8344,711.2,830.6344,703.2,840.2344,671.2,840.2344,663.2,830.6344,671.2,821.8344" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="28.8" x="672.8" y="835.0891">limits</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="402.8" x2="436.4" y1="861.5313" y2="861.5313"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="436.4" x2="436.4" y1="861.5313" y2="871.9313"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="403.6" x2="436.4" y1="871.9313" y2="871.9313"/><polygon fill="#A80036" points="411.6,868.7313,403.6,871.9313,411.6,875.1313,408.4,871.9313" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="408.4" y="857.7375">10</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="429.2" y="857.7375"/><path d="M406.4,882.3313 L406.4,914.3313 L518.4,914.3313 L518.4,890.3313 L510.4,882.3313 L406.4,882.3313 " fill="#D3D3D3" filter="url(#fxjublhwrxouk)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M510.4,882.3313 L510.4,890.3313 L518.4,890.3313 L510.4,882.3313 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="74.4" x="411.2" y="896.386">Evaluate 'facts'</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="95.2" x="411.2" y="908.6344">Invoke Rule Engine</text><path d="M315.6,927.6281 L365.2,927.6281 L365.2,933.2281 L357.2,941.2281 L315.6,941.2281 L315.6,927.6281 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="603.7391" style="stroke: #000000; stroke-width: 1.600000023841858;" width="408.8" x="315.6" y="927.6281"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13.6" x="327.6" y="938.4828">alt</text><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="106.4" x="377.2" y="937.736">[Threshold is breached]</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="402.8" x2="436.4" y1="958.525" y2="958.525"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="436.4" x2="436.4" y1="958.525" y2="968.925"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="403.6" x2="436.4" y1="968.925" y2="968.925"/><polygon fill="#A80036" points="411.6,965.725,403.6,968.925,411.6,972.125,408.4,968.925" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="408.4" y="954.7313">11</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="429.2" y="954.7313"/><path d="M406.4,979.325 L406.4,999.325 L557.6,999.325 L557.6,987.325 L549.6,979.325 L406.4,979.325 " fill="#D3D3D3" filter="url(#fxjublhwrxouk)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M549.6,979.325 L549.6,987.325 L557.6,987.325 L549.6,979.325 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="55.2" x="411.2" y="993.3797">Create new</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72.8" x="469.6" y="993.3797">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="542.4" y="993.3797">.</text><rect fill="#FFFFFF" filter="url(#fxjublhwrxouk)" height="44.7453" style="stroke: #000000; stroke-width: 1.600000023841858;" width="174.4" x="329.2" y="1006.7735"/><polygon fill="#EEEEEE" points="329.2,1006.7735,380.4,1006.7735,380.4,1012.3735,372.4,1020.3735,329.2,1020.3735,329.2,1006.7735" style="stroke: #000000; stroke-width: 1.600000023841858;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="15.2" x="339.6" y="1018.4281">ref</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="102.4" x="334" y="1033.6281">Notification Action {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/central-event-processor/tree/master/docs/sequence_diagramsnotification-actionFlow.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/central-event-processor/tree/master/docs/sequence_diagramsnotification-actionFlow.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="59.2" x="436.4" y="1033.6281">Action Flow</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="436.4" x2="495.6" y1="1035.2281" y2="1035.2281"/></a><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="495.6" y="1033.6281">}</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="337.2" y="1045.8766"/><line style="stroke: #000000; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="315.6" x2="724.4" y1="1056.3188" y2="1056.3188"/><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="175.2" x="319.6" y="1064.8266">[Threshold not breached - same event]</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="402.8" x2="436.4" y1="1084.5313" y2="1084.5313"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="436.4" x2="436.4" y1="1084.5313" y2="1094.9313"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="403.6" x2="436.4" y1="1094.9313" y2="1094.9313"/><polygon fill="#A80036" points="411.6,1091.7313,403.6,1094.9313,411.6,1098.1313,408.4,1094.9313" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="408.4" y="1080.7375">12</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="429.2" y="1080.7375"/><path d="M406.4,1105.3313 L406.4,1125.3313 L640.8,1125.3313 L640.8,1113.3313 L632.8,1105.3313 L406.4,1105.3313 " fill="#D3D3D3" filter="url(#fxjublhwrxouk)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M632.8,1105.3313 L632.8,1113.3313 L640.8,1113.3313 L632.8,1105.3313 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="56" x="411.2" y="1119.386">Send finish</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72.8" x="470.4" y="1119.386">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="82.4" x="546.4" y="1119.386">to Action Agent.</text><polygon fill="#A80036" points="674,1146.6281,682,1149.8281,674,1153.0281,677.2,1149.8281" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="402.8" x2="678.8" y1="1149.8281" y2="1149.8281"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="408.4" y="1146.0344">13</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="40" x="426" y="1146.0344">Request</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72.8" x="469.2" y="1146.0344">Action Object</text><path d="M406.4,1160.2281 L406.4,1192.2281 L585.6,1192.2281 L585.6,1168.2281 L577.6,1160.2281 L406.4,1160.2281 " fill="#D3D3D3" filter="url(#fxjublhwrxouk)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M577.6,1160.2281 L577.6,1168.2281 L585.6,1168.2281 L577.6,1160.2281 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="86.4" x="411.2" y="1174.2828">Request previous</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72.8" x="500.8" y="1174.2828">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="118.4" x="411.2" y="1186.5313">with same event details</text><polygon fill="#FFFFE0" filter="url(#fxjublhwrxouk)" points="670.4,1203.925,704.8,1203.925,712.8,1212.725,704.8,1222.325,670.4,1222.325,662.4,1212.725,670.4,1203.925" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="31.2" x="672" y="1217.1797">action</text><polygon fill="#A80036" points="411.6,1240.4219,403.6,1243.6219,411.6,1246.8219,408.4,1243.6219" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="406.8" x2="686.8" y1="1243.6219" y2="1243.6219"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="416.4" y="1239.8281">14</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="70.4" x="434" y="1239.8281">Return results</text><path d="M406.4,1254.0219 L406.4,1347.6219 L580.8,1347.6219 L580.8,1262.0219 L572.8,1254.0219 L406.4,1254.0219 " fill="#FBFB77" filter="url(#fxjublhwrxouk)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M572.8,1254.0219 L572.8,1262.0219 L580.8,1262.0219 L572.8,1254.0219 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="81.6" x="411.2" y="1268.0766">Event details for</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72.8" x="496" y="1268.0766">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="411.2" y="1280.325">{</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="48" x="424" y="1292.5735">limit type</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="43.2" x="424" y="1304.8219">currency</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="22.4" x="424" y="1317.0703">dfsp</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="131.2" x="424" y="1329.3188">notification endpoint type</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="3.2" x="411.2" y="1341.5672">}</text><path d="M323.6,1360.561 L373.2,1360.561 L373.2,1366.161 L365.2,1374.161 L323.6,1374.161 L323.6,1360.561 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 0.800000011920929;"/><rect fill="none" height="91.1094" style="stroke: #000000; stroke-width: 1.600000023841858;" width="304.4" x="323.6" y="1360.561"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="13.6" x="335.6" y="1371.4156">alt</text><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87.2" x="385.2" y="1370.6688">[Action Event exist]</text><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="402.8" x2="436.4" y1="1391.4578" y2="1391.4578"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="436.4" x2="436.4" y1="1391.4578" y2="1401.8578"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="403.6" x2="436.4" y1="1401.8578" y2="1401.8578"/><polygon fill="#A80036" points="411.6,1398.6578,403.6,1401.8578,411.6,1405.0578,408.4,1401.8578" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="408.4" y="1387.6641">15</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="0" x="429.2" y="1387.6641"/><path d="M406.4,1412.2578 L406.4,1432.2578 L616.8,1432.2578 L616.8,1420.2578 L608.8,1412.2578 L406.4,1412.2578 " fill="#D3D3D3" filter="url(#fxjublhwrxouk)" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><path d="M608.8,1412.2578 L608.8,1420.2578 L616.8,1420.2578 L608.8,1412.2578 " fill="#D3D3D3" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="87.2" x="411.2" y="1426.3125">Deactive pending</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72.8" x="501.6" y="1426.3125">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="27.2" x="577.6" y="1426.3125">event</text><line style="stroke: #000000; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="323.6" x2="628" y1="1440.5063" y2="1440.5063"/><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="128.8" x="327.6" y="1449.0141">[Action Event does not exist]</text><polygon fill="#A80036" points="674,1471.1188,682,1474.3188,674,1477.5188,677.2,1474.3188" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><line style="stroke: #A80036; stroke-width: 0.800000011920929;" x1="402.8" x2="678.8" y1="1474.3188" y2="1474.3188"/><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="14.4" x="408.4" y="1470.525">16</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="77.6" x="426" y="1470.525">Persist updated</text><text fill="#000000" font-family="sans-serif" font-size="10.4" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="72.8" x="506.8" y="1470.525">Action Object</text><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="91.2" x="582.8" y="1470.525">event to CEP Store</text><polygon fill="#FFFFE0" filter="url(#fxjublhwrxouk)" points="670.4,1508.7188,704.8,1508.7188,712.8,1517.5188,704.8,1527.1188,670.4,1527.1188,662.4,1517.5188,670.4,1508.7188" style="stroke: #A80036; stroke-width: 0.800000011920929;"/><text fill="#000000" font-family="sans-serif" font-size="10.4" lengthAdjust="spacingAndGlyphs" textLength="31.2" x="672" y="1521.9735">action</text><line style="stroke: #000000; stroke-width: 0.800000011920929; stroke-dasharray: 2.0,2.0;" x1="18.4" x2="732.4" y1="1537.7672" y2="1537.7672"/><text fill="#000000" font-family="sans-serif" font-size="8.8" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="222.4" x="22.4" y="1546.275">[Message does not qualify for notification action]</text><!--
@startuml
title 10.3. Notification Limit Position Breach
autonumber

collections "Notification-Topic" as TOPIC_NOTIFY
boundary "Central Admin API" as CLAPI
control "Central Event Processor" as CEP
database "CEP Store" as DB

box "Central Services" #LightYellow
participant CLAPI
participant TOPIC_NOTIFY
end box
box "Central Event Processing Services" #LightGreen
participant CEP
participant DB
end box

Group Limit Position Breach
    activate CEP
    note right of TOPIC_NOTIFY #LightGrey
        Events are published
        to Notification Topic
        by Central Services
    end note
    TOPIC_NOTIFY <- CEP: Consumes notification messages
    activate TOPIC_NOTIFY
    deactivate TOPIC_NOTIFY
    CEP -> CEP: Filter according to event action
    note right of CEP
        Qualifying event action

        {
            data.value.metadata.event.action === 'commit'
        }
    end note

    alt Messages event type that qualify
        CLAPI <- CEP: Request notification info for both payee and payer\n<color #FF0000><b>Error codes:</b> 2001, 2003 </color>
        activate CLAPI
        deactivate CLAPI
        CEP -> DB: Persist message related data to CEP store
        activate DB
        hnote over DB #LightYellow
            events
        end hnote
        deactivate DB
        CLAPI <- CEP: Request current positions info for both payee and payer\n<color #FF0000><b>Error codes:</b> 2001, 2003 </color>
        activate CLAPI
        deactivate CLAPI
        CEP -> DB: Request current limits
        activate DB
        hnote over DB #LightYellow
            limits
        end hnote
        note right of CEP #LightGrey
            API call to CEP Store
            requesting current **limits**
            for **payee** and **payer**
        end note
        CEP <- - DB: Return results current limits
        deactivate DB
        CEP -> CEP:
        note right of CEP #LightGrey
            Calculate the current **threshold**
            **percentage** for both **payee** and **payer**
            for all **currencies**
        end note
        CEP -> DB: Persist new position with threshold information
        activate DB
        hnote over DB #LightYellow
            limits
        end hnote
        deactivate DB
        CEP -> CEP
        note right of CEP #LightGrey
            Evaluate 'facts'
            Invoke Rule Engine
        end note

        alt Threshold is breached
            CEP -> CEP
            note right of CEP #LightGrey
                Create new **Action Object**.
            end note
            ref over CEP :  Notification Action {[[https://github.com/mojaloop/central-event-processor/tree/master/docs/sequence_diagramsnotification-actionFlow.svg Action Flow]]} \n
        else Threshold not breached - same event
            CEP -> CEP
            note right of CEP #LightGrey
                Send finish **Action Object** to Action Agent.
            end note
            CEP -> DB: Request **Action Object**
            note right of CEP #LightGrey
                Request previous **Action Object**
                with same event details
            end note
            activate DB
        hnote over DB #LightYellow
            action
        end hnote
        CEP <- - DB: Return results
        deactivate DB
            note right of CEP
                Event details for **Action Object**
                {
                    limit type
                    currency
                    dfsp
                    notification endpoint type
                }
            end note
            alt Action Event exist
                CEP -> CEP
                note right of CEP #LightGrey
                    Deactive pending **Action Object** event
                end note
            else Action Event does not exist
            end
        CEP -> DB: Persist updated **Action Object** event to CEP Store
        activate DB
        hnote over DB #LightYellow
            action
        end hnote
        deactivate DB
        end
    else Message does not qualify for notification action
    end
    deactivate CEP
end
@enduml

PlantUML version 1.2018.11(Sat Sep 22 18:43:53 SAST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1343-b26
Operating System: Mac OS X
OS Version: 10.14.2
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>